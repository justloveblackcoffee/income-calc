<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>China Benefit & Net Income Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
    h1 { text-align: center; }
    .container { display: flex; flex-wrap: wrap; gap: 20px; }
    .inputs, .results { flex: 1; min-width: 400px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 5px; margin-top: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: right; }
    th { background-color: #eee; }
    .benefits-table td:first-child { text-align: left; }
    #benefits table td:first-child { text-align: left; }
    .benefit-note { font-size: 0.85em; color: #666; font-style: italic; }
  </style>
</head>
<body>
  <div style="text-align: right; margin-bottom: 10px;">
    <label>Language / 语言: 
      <select id="languageSelect" style="width: auto; padding: 5px;">
        <option value="en">English</option>
        <option value="zh">中文</option>
      </select>
    </label>
  </div>
  <h1 id="pageTitle">China Benefit & Net Income Calculator</h1>
  <div class="container">
    <div class="inputs">
      <h2 id="inputHeader">Input</h2>
      <label id="labelSalaryUSD">Base Salary (USD)<input type="number" id="salaryUSD" value="1000"></label>
      <label id="labelExchangeRate">Exchange Rate (USD→RMB)<input type="number" id="rate" value="7.12" step="0.01"></label>
      <label id="labelSalaryRMB">Base Salary (RMB)<input type="number" id="salaryRMB" value="7120"></label>
      <label id="labelCity">City
        <select id="city">
          <option value="shanghai">Shanghai / 上海</option>
          <option value="hangzhou">Hangzhou / 杭州</option>
        </select>
      </label>
      <h3 id="limitsHeader">Social Insurance / Housing Fund Limits (2025.7-2026.6)</h3>
      <label id="labelSIUpper">Social Insurance Upper Limit (RMB)<input type="number" id="siUpper" value="37302"></label>
      <label id="labelSILower">Social Insurance Lower Limit (RMB)<input type="number" id="siLower" value="7460"></label>
      <label id="labelHFUpper">Housing Fund Upper Limit (RMB)<input type="number" id="hfUpper" value="37302"></label>
      <label id="labelHFLower">Housing Fund Lower Limit (RMB)<input type="number" id="hfLower" value="7460"></label>

      <h3 id="benefitRatesHeader">Benefit Rates (Employer / Employee)</h3>
      <table class="benefits-table">
        <tr><th id="thCategory">Category</th><th id="thEmployer">Employer %</th><th id="thEmployee">Employee %</th></tr>
        <tr><td><span id="tdPension">Pension Insurance</span><br/><span class="benefit-note" id="notePension"></span></td><td><input type="number" id="penE" value="16"></td><td><input type="number" id="penP" value="8"></td></tr>
        <tr><td><span id="tdMedical">Medical Insurance</span><br/><span class="benefit-note" id="noteMedical"></span></td><td><input type="number" id="medE" value="10"></td><td><input type="number" id="medP" value="2"></td></tr>
        <tr><td><span id="tdUnemployment">Unemployment Insurance</span><br/><span class="benefit-note" id="noteUnemployment"></span></td><td><input type="number" id="uneE" value="0.5"></td><td><input type="number" id="uneP" value="0.5"></td></tr>
        <tr><td><span id="tdWorkInjury">Work Injury Insurance</span><br/><span class="benefit-note" id="noteWorkInjury"></span></td><td><input type="number" id="injE" value="0.26"></td><td><input type="number" id="injP" value="0"></td></tr>
        <tr><td><span id="tdMaternity">Maternity Insurance</span><br/><span class="benefit-note" id="noteMaternity"></span></td><td><input type="number" id="matE" value="0"></td><td><input type="number" id="matP" value="0"></td></tr>
        <tr><td><span id="tdHousing">Housing Fund</span><br/><span class="benefit-note" id="noteHousing"></span></td><td><input type="number" id="houE" value="7"></td><td><input type="number" id="houP" value="7"></td></tr>
        <tr><td><span id="tdSupplementary">Supplementary HF (Optional)</span><br/><span class="benefit-note" id="noteSupplementary"></span></td><td><input type="number" id="supE" value="2"></td><td><input type="number" id="supP" value="2"></td></tr>
        <tr><td><span id="tdCorporate">Corporate Pension (Optional)</span><br/><span class="benefit-note" id="noteCorporate"></span></td><td><input type="number" id="corE" value="8"></td><td><input type="number" id="corP" value="4"></td></tr>
      </table>

      <label id="labelCommercial">Commercial Insurance (Optional, Employer, RMB/year)<input type="number" id="comE" value="2000"></label>
    </div>

    <div class="results">
      <h2 id="resultsHeader">Results</h2>
      <div id="benefits"></div>
      <div id="summary"></div>
      <h3 id="taxTableHeader">12-Month Tax Table</h3>
      <table id="taxTable">
        <thead>
          <tr><th id="thMonth">Month</th><th id="thCumulative">Cumulative Taxable (¥)</th><th id="thRate">Rate %</th><th id="thQuickDed">Quick Deduction</th><th id="thTax">Tax (¥)</th><th id="thNetPay">Net Pay (¥)</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const cityConfig = {
      "cities": {
        "shanghai": {
          "meta": {
            "city_cn": "上海",
            "year": 2025,
            "social_insurance_base": { "lower": 7460, "upper": 37302 },
            "housing_fund_base": { "lower": 2690, "upper": 37302 }
          },
          "benefits": {
            "pension": {
              "name": "Pension Insurance",
              "cn": "养老保险",
              "employer_rate": 0.16,
              "employee_rate": 0.08,
              "note_en": "",
              "note_cn": "‌‌"
            },
            "medical": {
              "name": "Medical Insurance",
              "cn": "医疗保险",
              "employer_rate": 0.09,
              "employee_rate": 0.02,
              "note_en": "",
              "note_cn": ""
            },
            "unemployment": {
              "name": "Unemployment Insurance",
              "cn": "失业保险",
              "employer_rate": 0.005,
              "employee_rate": 0.005,
              "note_en": "",
              "note_cn": ""
            },
            "work_injury": {
              "name": "Work Injury Insurance",
              "cn": "工伤保险",
              "employer_rate": 0.002,
              "employee_rate": 0,
              "note_en": "Rate varies by industry risk (0.2%–1.9%)",
              "note_cn": "行业风险高低决定费率 (0.2%–1.9%)"
            },
            "maternity": {
              "name": "Maternity Insurance",
              "cn": "生育保险",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Merged into medical insurance",
              "note_cn": "已并入医疗保险"
            },
            "housing_fund": {
              "name": "Housing Provident Fund",
              "cn": "住房公积金",
              "employer_rate": 0.07,
              "employee_rate": 0.07,
              "range_allowed": [0.05, 0.07],
              "note_en": "Company-defined, same for employer and employee (5%-7%)",
              "note_cn": "企业可自主选择，单位和个人比例相同（5%-7%）。‌‌"
            },
            "supplementary_housing": {
              "name": "Supplementary Housing Fund",
              "cn": "补充公积金",
              "employer_rate": 0.02,
              "employee_rate": 0.02,
              "range_allowed": [0.01, 0.06],
              "note_en": "Company-defined, same for employer and employee (1%-6%)",
              "note_cn": "企业可自主选择，单位和个人比例相同（1%-6%）。‌‌",
              "optional": true
            },
            "corporate_pension": {
              "name": "Corporate Pension",
              "cn": "企业年金",
              "employer_rate": 0.08,
              "employee_rate": 0.04,
              "note_en": "Company-defined",
              "note_cn": "单位和个人比例可不同",
              "optional": true,
              "base": "base_salary"
            },
            "commercial_insurance": {
              "name": "Group Commercial Insurance",
              "cn": "团体商业保险",
              "employer_paid": 2000,
              "unit": "CNY/year",
              "note_en": "Optional, enterprise-defined",
              "note_cn": "可选，个人不需要缴纳",
              "optional": true
            }
          }
        },
        "hangzhou": {
          "meta": {
            "city_cn": "杭州",
            "year": 2025,
            "social_insurance_base": { "lower": 4986, "upper": 25299 },
            "housing_fund_base": { "lower": 2490, "upper": 40694 }
          },
          "benefits": {
            "pension": {
              "name": "Pension Insurance",
              "cn": "养老保险",
              "employer_rate": 0.14,
              "employee_rate": 0.08,
              "note_en": "Employer contribution: 14%-16%",
              "note_cn": "单位比例：14%-16%‌"
            },
            "medical": {
              "name": "Medical Insurance",
              "cn": "医疗保险",
              "employer_rate": 0.095,
              "employee_rate": 0.02,
              "note_en": "Employer contribution: 9.5%-10.5%",
              "note_cn": "单位比例：9.5%-10.5%"
            },
            "unemployment": {
              "name": "Unemployment Insurance",
              "cn": "失业保险",
              "employer_rate": 0.005,
              "employee_rate": 0.005,
              "note_en": "",
              "note_cn": "‌‌"
            },
            "work_injury": {
              "name": "Work Injury Insurance",
              "cn": "工伤保险",
              "employer_rate": 0.002,
              "employee_rate": 0,
              "note_en": "Varies by industry (0.2%–0.8%)",
              "note_cn": "行业风险高低决定费率 (0.2%–0.8%)"
            },
            "maternity": {
              "name": "Maternity Insurance",
              "cn": "生育保险",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Merged into medical insurance",
              "note_cn": "已并入医疗保险"
            },
            "housing_fund": {
              "name": "Housing Provident Fund",
              "cn": "住房公积金",
              "employer_rate": 0.12,
              "employee_rate": 0.12,
              "range_allowed": [0.05, 0.12],
              "note_en": "Company-defined, same for employer and employee (5%-12%)",
              "note_cn": "企业可自主选择，单位和个人比例相同（5%-12%）。‌‌"
            },
            "supplementary_housing": {
              "name": "Supplementary Housing Fund",
              "cn": "补充公积金",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Not applicable in Hangzhou",
              "note_cn": "杭州没有补充公积金‌‌",
              "optional": true
            },
            "corporate_pension": {
              "name": "Corporate Pension",
              "cn": "企业年金",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Company-defined",
              "note_cn": "单位和个人比例可不同",
              "optional": true,
              "base": "base_salary"
            },
            "commercial_insurance": {
              "name": "Group Commercial Insurance",
              "cn": "团体商业保险",
              "employer_paid": 0,
              "unit": "CNY/year",
              "note_en": "Optional, enterprise-defined",
              "note_cn": "可选，个人不需要缴纳",
              "optional": true
            }
          }
        }
      }
    };

    const translations = {
      en: {
        pageTitle: "China Benefit & Net Income Calculator",
        inputHeader: "Input",
        resultsHeader: "Results",
        labelSalaryUSD: "Base Salary (USD)",
        labelExchangeRate: "Exchange Rate (USD→RMB)",
        labelSalaryRMB: "Base Salary (RMB)",
        labelCity: "City",
        limitsHeader: "Social Insurance / Housing Fund Limits (2025.7-2026.6)",
        labelSIUpper: "Social Insurance Upper Limit (RMB)",
        labelSILower: "Social Insurance Lower Limit (RMB)",
        labelHFUpper: "Housing Fund Upper Limit (RMB)",
        labelHFLower: "Housing Fund Lower Limit (RMB)",
        benefitRatesHeader: "Benefit Rates (Employer / Employee)",
        thCategory: "Category",
        thEmployer: "Employer %",
        thEmployee: "Employee %",
        tdPension: "Pension Insurance",
        tdMedical: "Medical Insurance",
        tdUnemployment: "Unemployment Insurance",
        tdWorkInjury: "Work Injury Insurance",
        tdMaternity: "Maternity Insurance",
        tdHousing: "Housing Fund",
        tdSupplementary: "Supplementary HF (Optional)",
        tdCorporate: "Corporate Pension (Optional)",
        labelCommercial: "Commercial Insurance (Optional, Employer, RMB/year)",
        taxTableHeader: "12-Month Tax Table",
        thMonth: "Month",
        thCumulative: "Cumulative Taxable (¥)",
        thRate: "Rate %",
        thQuickDed: "Quick Deduction",
        thTax: "Tax (¥)",
        thNetPay: "Net Pay (¥)",
        benefitCalcHeader: "Benefit Calculation",
        benefitTableCategory: "Category",
        benefitTableBase: "Base",
        benefitTableEmployer: "Employer ¥",
        benefitTableEmployee: "Employee ¥",
        commercialInsuranceRow: "Commercial Insurance (Optional)",
        employerTotal: "Employer Total:",
        employeeTotal: "Employee Total:",
        monthlyTaxableIncome: "Monthly Taxable Income:",
        taxableFormulaPrefix: "(Base Salary ¥",
        taxableFormulaMid1: " - Employee Benefits ¥",
        taxableFormulaMid2: " - Standard Deduction ¥",
        taxableFormulaSuffix: ")"
      },
      zh: {
        pageTitle: "中国社保公积金及税后收入计算器",
        inputHeader: "输入",
        resultsHeader: "结果",
        labelSalaryUSD: "基本工资 (美元)",
        labelExchangeRate: "汇率 (USD→RMB)",
        labelSalaryRMB: "基本工资 (人民币)",
        labelCity: "城市",
        limitsHeader: "社保 / 公积金缴费基数限制 (2025.7-2026.6)",
        labelSIUpper: "社保缴费基数上限 (人民币)",
        labelSILower: "社保缴费基数下限 (人民币)",
        labelHFUpper: "公积金缴费基数上限 (人民币)",
        labelHFLower: "公积金缴费基数下限 (人民币)",
        benefitRatesHeader: "福利缴纳比例 (单位 / 个人)",
        thCategory: "类别",
        thEmployer: "单位 %",
        thEmployee: "个人 %",
        tdPension: "养老保险",
        tdMedical: "医疗保险",
        tdUnemployment: "失业保险",
        tdWorkInjury: "工伤保险",
        tdMaternity: "生育保险",
        tdHousing: "住房公积金",
        tdSupplementary: "补充公积金 (可选)",
        tdCorporate: "企业年金 (可选)",
        labelCommercial: "商业保险 (可选，单位，人民币/年)",
        taxTableHeader: "12个月税额表",
        thMonth: "月份",
        thCumulative: "累计应税收入 (¥)",
        thRate: "税率 %",
        thQuickDed: "速算扣除数",
        thTax: "应纳税额 (¥)",
        thNetPay: "税后收入 (¥)",
        benefitCalcHeader: "福利计算",
        benefitTableCategory: "类别",
        benefitTableBase: "缴费基数",
        benefitTableEmployer: "单位 ¥",
        benefitTableEmployee: "个人 ¥",
        commercialInsuranceRow: "商业保险 (可选)",
        employerTotal: "单位合计:",
        employeeTotal: "个人合计:",
        monthlyTaxableIncome: "月度应税收入:",
        taxableFormulaPrefix: "(基本工资 ¥",
        taxableFormulaMid1: " - 个人福利 ¥",
        taxableFormulaMid2: " - 标准扣除 ¥",
        taxableFormulaSuffix: ")"
      }
    };

    let currentLanguage = 'en';

    const benefitNoteMapping = {
      'notePension': 'pension',
      'noteMedical': 'medical',
      'noteUnemployment': 'unemployment',
      'noteWorkInjury': 'work_injury',
      'noteMaternity': 'maternity',
      'noteHousing': 'housing_fund',
      'noteSupplementary': 'supplementary_housing',
      'noteCorporate': 'corporate_pension'
    };

    function updateBenefitNotes() {
      const city = citySelect.value;
      const config = cityConfig.cities[city];
      
      Object.keys(benefitNoteMapping).forEach(noteId => {
        const benefitKey = benefitNoteMapping[noteId];
        const benefit = config.benefits[benefitKey];
        const note = currentLanguage === 'zh' ? (benefit.note_cn || '') : (benefit.note_en || '');
        document.getElementById(noteId).innerText = note;
      });
    }

    function updateLanguage(lang) {
      currentLanguage = lang;
      const t = translations[lang];
      
      // Update all static text elements
      document.getElementById('pageTitle').innerText = t.pageTitle;
      document.getElementById('inputHeader').innerText = t.inputHeader;
      document.getElementById('resultsHeader').innerText = t.resultsHeader;
      document.getElementById('limitsHeader').innerText = t.limitsHeader;
      document.getElementById('benefitRatesHeader').innerText = t.benefitRatesHeader;
      document.getElementById('taxTableHeader').innerText = t.taxTableHeader;
      
      // Update labels (preserve input elements)
      document.getElementById('labelSalaryUSD').childNodes[0].nodeValue = t.labelSalaryUSD;
      document.getElementById('labelExchangeRate').childNodes[0].nodeValue = t.labelExchangeRate;
      document.getElementById('labelSalaryRMB').childNodes[0].nodeValue = t.labelSalaryRMB;
      document.getElementById('labelCity').childNodes[0].nodeValue = t.labelCity;
      document.getElementById('labelSIUpper').childNodes[0].nodeValue = t.labelSIUpper;
      document.getElementById('labelSILower').childNodes[0].nodeValue = t.labelSILower;
      document.getElementById('labelHFUpper').childNodes[0].nodeValue = t.labelHFUpper;
      document.getElementById('labelHFLower').childNodes[0].nodeValue = t.labelHFLower;
      document.getElementById('labelCommercial').childNodes[0].nodeValue = t.labelCommercial;
      
      // Update table headers
      document.getElementById('thCategory').innerText = t.thCategory;
      document.getElementById('thEmployer').innerText = t.thEmployer;
      document.getElementById('thEmployee').innerText = t.thEmployee;
      
      // Update benefit categories
      document.getElementById('tdPension').innerText = t.tdPension;
      document.getElementById('tdMedical').innerText = t.tdMedical;
      document.getElementById('tdUnemployment').innerText = t.tdUnemployment;
      document.getElementById('tdWorkInjury').innerText = t.tdWorkInjury;
      document.getElementById('tdMaternity').innerText = t.tdMaternity;
      document.getElementById('tdHousing').innerText = t.tdHousing;
      document.getElementById('tdSupplementary').innerText = t.tdSupplementary;
      document.getElementById('tdCorporate').innerText = t.tdCorporate;
      
      // Update tax table headers
      document.getElementById('thMonth').innerText = t.thMonth;
      document.getElementById('thCumulative').innerText = t.thCumulative;
      document.getElementById('thRate').innerText = t.thRate;
      document.getElementById('thQuickDed').innerText = t.thQuickDed;
      document.getElementById('thTax').innerText = t.thTax;
      document.getElementById('thNetPay').innerText = t.thNetPay;
      
      // Update benefit notes
      updateBenefitNotes();
      
      // Recalculate to update dynamic content
      calculate();
    }

    const rateInput = document.getElementById('rate');
    const salaryUSD = document.getElementById('salaryUSD');
    const salaryRMB = document.getElementById('salaryRMB');
    const citySelect = document.getElementById('city');
    const languageSelect = document.getElementById('languageSelect');

    function syncCurrency(e){
      const rate = parseFloat(rateInput.value)||7.12;
      if(e.target===salaryUSD){ salaryRMB.value=(salaryUSD.value*rate).toFixed(2); }
      else if(e.target===salaryRMB){ salaryUSD.value=(salaryRMB.value/rate).toFixed(2); }
      calculate();
    }
    rateInput.addEventListener('input', syncCurrency);
    salaryUSD.addEventListener('input', syncCurrency);
    salaryRMB.addEventListener('input', syncCurrency);

    // Language selector
    languageSelect.addEventListener('change', function() {
      updateLanguage(this.value);
    });

    // Update form values when city changes
    function loadCityConfig(){
      const city = citySelect.value;
      const config = cityConfig.cities[city];
      
      // Update base limits
      document.getElementById('siUpper').value = config.meta.social_insurance_base.upper;
      document.getElementById('siLower').value = config.meta.social_insurance_base.lower;
      document.getElementById('hfUpper').value = config.meta.housing_fund_base.upper;
      document.getElementById('hfLower').value = config.meta.housing_fund_base.lower;
      
      // Update benefit rates
      document.getElementById('penE').value = (config.benefits.pension.employer_rate * 100).toFixed(2);
      document.getElementById('penP').value = (config.benefits.pension.employee_rate * 100).toFixed(2);
      document.getElementById('medE').value = (config.benefits.medical.employer_rate * 100).toFixed(2);
      document.getElementById('medP').value = (config.benefits.medical.employee_rate * 100).toFixed(2);
      document.getElementById('uneE').value = (config.benefits.unemployment.employer_rate * 100).toFixed(2);
      document.getElementById('uneP').value = (config.benefits.unemployment.employee_rate * 100).toFixed(2);
      document.getElementById('injE').value = (config.benefits.work_injury.employer_rate * 100).toFixed(2);
      document.getElementById('injP').value = (config.benefits.work_injury.employee_rate * 100).toFixed(2);
      document.getElementById('matE').value = (config.benefits.maternity.employer_rate * 100).toFixed(2);
      document.getElementById('matP').value = (config.benefits.maternity.employee_rate * 100).toFixed(2);
      document.getElementById('houE').value = (config.benefits.housing_fund.employer_rate * 100).toFixed(2);
      document.getElementById('houP').value = (config.benefits.housing_fund.employee_rate * 100).toFixed(2);
      document.getElementById('supE').value = (config.benefits.supplementary_housing.employer_rate * 100).toFixed(2);
      document.getElementById('supP').value = (config.benefits.supplementary_housing.employee_rate * 100).toFixed(2);
      document.getElementById('corE').value = (config.benefits.corporate_pension.employer_rate * 100).toFixed(2);
      document.getElementById('corP').value = (config.benefits.corporate_pension.employee_rate * 100).toFixed(2);
      document.getElementById('comE').value = config.benefits.commercial_insurance.employer_paid;
      
      // Update benefit notes
      updateBenefitNotes();
      
      calculate();
    }
    
    citySelect.addEventListener('change', loadCityConfig);

    const taxBrackets=[
      {max:36000,rate:0.03,ded:0},
      {max:144000,rate:0.10,ded:2520},
      {max:300000,rate:0.20,ded:16920},
      {max:420000,rate:0.25,ded:31920},
      {max:660000,rate:0.30,ded:52920},
      {max:960000,rate:0.35,ded:85920},
      {max:Infinity,rate:0.45,ded:181920}
    ];

    const ids=['pen','med','une','inj','mat','hou','sup','cor'];
    const idNames={
      'pen':'Pension Insurance',
      'med':'Medical Insurance', 
      'une':'Unemployment Insurance',
      'inj':'Work Injury Insurance',
      'mat':'Maternity Insurance',
      'hou':'Housing Fund',
      'sup':'Supplementary HF (Optional)',
      'cor':'Corporate Pension (Optional)'
    };
    const idToElementId={
      'pen':'tdPension',
      'med':'tdMedical',
      'une':'tdUnemployment',
      'inj':'tdWorkInjury',
      'mat':'tdMaternity',
      'hou':'tdHousing',
      'sup':'tdSupplementary',
      'cor':'tdCorporate'
    };

    function calculate(){
      const base=parseFloat(salaryRMB.value)||0;
      const siU=parseFloat(siUpper.value),siL=parseFloat(siLower.value);
      const hfU=parseFloat(hfUpper.value),hfL=parseFloat(hfLower.value);

      let siBase=Math.min(Math.max(base,siL),siU);
      let hfBase=Math.min(Math.max(base,hfL),hfU);

      // Get current city config for extra fixed amounts
      const city = citySelect.value;
      const config = cityConfig.cities[city];

      // Get translations for current language
      const t = translations[currentLanguage];

      let empE=0, empP=0;
      let details=`<h3>${t.benefitCalcHeader}</h3><table><tr><th>${t.benefitTableCategory}</th><th>${t.benefitTableBase}</th><th>${t.benefitTableEmployer}</th><th>${t.benefitTableEmployee}</th></tr>`;
      ids.forEach(id=>{
        const e=document.getElementById(id+'E').value/100;
        const p=document.getElementById(id+'P').value/100;
        let b=(id==='hou'||id==='sup')?hfBase:(id==='cor'?base:siBase);
        const eAmt=b*e;
        let pAmt=b*p;
        
        empE+=eAmt;
        empP+=pAmt;
        // Use translated category name
        const categoryName = document.getElementById(idToElementId[id]).innerText;
        
        details+=`<tr><td>${categoryName}</td><td>${b.toFixed(2)}</td><td>${eAmt.toFixed(2)}</td><td>${pAmt.toFixed(2)}</td></tr>`;
      });

      const comE=parseFloat(document.getElementById('comE').value)||0;
      const comEMonthly=comE/12;
      empE+=comEMonthly;
      
      // Add commercial insurance row to the table
      if(comE > 0){
        details+=`<tr><td>${t.commercialInsuranceRow}</td><td>${comE.toFixed(2)}/year</td><td>${comEMonthly.toFixed(2)}</td><td>0.00</td></tr>`;
      }

      details+="</table>";
      document.getElementById('benefits').innerHTML=details;

      const standardDeduction=5000;
      const monthlyTaxable=Math.max(base-standardDeduction-empP,0);

      let tbody=document.querySelector('#taxTable tbody');
      tbody.innerHTML='';
      let prevTax=0;
      for(let m=1;m<=12;m++){
        const cum=monthlyTaxable*m;
        const br=taxBrackets.find(b=>cum<=b.max);
        const totalTax=cum*br.rate-br.ded;
        const monthTax=Math.max(totalTax-prevTax,0);
        prevTax=totalTax;
        const net=monthlyTaxable-monthTax;
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${m}</td><td>${cum.toFixed(2)}</td><td>${(br.rate*100).toFixed(0)}%</td><td>${br.ded}</td><td>${monthTax.toFixed(2)}</td><td>${net.toFixed(2)}</td>`;
        tbody.appendChild(tr);
      }

      document.getElementById('summary').innerHTML=
        `<p><b>${t.employerTotal}</b> ¥${empE.toFixed(2)} / month</p>
         <p><b>${t.employeeTotal}</b> ¥${empP.toFixed(2)} / month</p>
         <p><b>${t.monthlyTaxableIncome}</b> ¥${monthlyTaxable.toFixed(2)}<br/>
            <small style="color: #666;">${t.taxableFormulaPrefix}${base.toFixed(2)}${t.taxableFormulaMid1}${empP.toFixed(2)}${t.taxableFormulaMid2}${standardDeduction}${t.taxableFormulaSuffix}</small></p>`;
    }

    document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input',calculate));
    
    // Load initial city config
    loadCityConfig();
  </script>
</body>
</html>