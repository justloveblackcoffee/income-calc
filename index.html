<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>China Benefit & Net Income Calculator</title>
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-dark: #1e40af;
      --secondary-color: #64748b;
      --background: #f8fafc;
      --surface: #ffffff;
      --border: #e2e8f0;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --success: #10b981;
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 0.75rem;
      --spacing-lg: 1rem;
      --spacing-xl: 1.25rem;
      --radius-sm: 0.25rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 4px 6px -2px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.4;
      padding: var(--spacing-sm);
    }

    header {
      max-width: 1400px;
      margin: 0 auto var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    h1 {
      font-size: clamp(1.25rem, 3vw, 1.75rem);
      font-weight: 700;
      color: var(--primary-color);
      flex: 1;
      min-width: 200px;
    }

    .language-selector {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    main {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 450px), 1fr));
      gap: var(--spacing-md);
    }

    section {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: var(--spacing-md);
      box-shadow: var(--shadow-md);
    }

    h2 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
      padding-bottom: var(--spacing-xs);
      border-bottom: 2px solid var(--primary-color);
    }

    h3 {
      font-size: 0.95rem;
      font-weight: 600;
      margin: var(--spacing-md) 0 var(--spacing-sm);
      color: var(--text-primary);
    }

    .form-group {
      margin-bottom: var(--spacing-sm);
    }

    label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.125rem;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 0.4rem 0.6rem;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      transition: all 0.2s ease;
      background: var(--surface);
    }

    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    input[type="number"]:hover,
    select:hover {
      border-color: var(--primary-dark);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--spacing-sm);
      font-size: 0.8rem;
      overflow-x: auto;
      display: block;
    }

    thead {
      display: table;
      width: 100%;
      table-layout: fixed;
    }

    tbody {
      display: table;
      width: 100%;
      table-layout: fixed;
    }

    th {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      font-weight: 600;
      padding: 0.4rem 0.5rem;
      text-align: right;
      font-size: 0.75rem;
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    td {
      border: 1px solid var(--border);
      padding: 0.4rem 0.5rem;
      text-align: right;
    }

    tbody tr:hover {
      background: var(--background);
    }

    .rate-input-cell {
      padding: 0.15rem;
    }

    .rate-input-cell input {
      padding: 0.25rem 0.4rem;
      font-size: 0.8rem;
      text-align: center;
    }

    .benefit-note {
      font-size: 0.7rem;
      color: var(--text-secondary);
      font-style: italic;
      display: block;
      margin-top: 0.125rem;
    }

    .summary-box {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-left: 4px solid var(--primary-color);
      padding: var(--spacing-sm);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-sm);
    }

    .summary-box p {
      margin-bottom: var(--spacing-xs);
    }

    .summary-box b {
      color: var(--primary-color);
    }

    .summary-box small {
      color: var(--text-secondary);
      display: block;
      margin-top: 0.125rem;
    }

    @media (max-width: 768px) {
      body {
        padding: 0.25rem;
      }

      section {
        padding: var(--spacing-sm);
      }

      h1 {
        font-size: 1.25rem;
      }

      table {
        font-size: 0.7rem;
      }

      th, td {
        padding: 0.25rem;
      }
    }

    @media (max-width: 480px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
      }

      .language-selector {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="pageTitle">China Benefit & Net Income Calculator</h1>
    <div class="language-selector">
      <label for="languageSelect">Language / ËØ≠Ë®Ä:</label>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="zh">‰∏≠Êñá</option>
      </select>
    </div>
  </header>
  <main>
    <section class="inputs">
      <h2 id="inputHeader">Input</h2>
      
      <div class="form-group">
        <label id="labelSalaryUSD" for="salaryUSD">Base Salary (USD)</label>
        <input type="number" id="salaryUSD" value="14044.94">
      </div>
      
      <div class="form-group">
        <label id="labelExchangeRate" for="rate">Exchange Rate (USD‚ÜíCNY)</label>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <input type="number" id="rate" value="7.12" step="0.01" style="flex: 1;">
          <button id="refreshRateBtn" type="button" style="
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.4rem 0.6rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            min-width: 2.5rem;
            justify-content: center;
          " onmouseover="this.style.background='var(--primary-dark)'" onmouseout="this.style.background='var(--primary-color)'">
            <span id="refreshIcon">üîÑ</span>
            <span id="refreshText" style="font-size: 0.7rem;">Refresh</span>
          </button>
        </div>
        <small id="rateStatus" style="color: var(--text-secondary); font-size: 0.7rem; margin-top: 0.25rem; display: block;"></small>
      </div>
      
      <div class="form-group">
        <label id="labelSalaryRMB" for="salaryRMB">Base Salary (CNY)</label>
        <input type="number" id="salaryRMB" value="100000">
      </div>
      
      <div class="form-group">
        <label id="labelCity" for="city">City</label>
        <select id="city">
          <option value="shanghai">Shanghai / ‰∏äÊµ∑</option>
          <option value="hangzhou">Hangzhou / Êù≠Â∑û</option>
        </select>
      </div>

      <h3 id="limitsHeader">Social Insurance / Housing Fund Limits (2025.7-2026.6)</h3>
      
      <div class="form-group">
        <label id="labelSIUpper" for="siUpper">Social Insurance Upper Limit (CNY)</label>
        <input type="number" id="siUpper" value="37302">
      </div>
      
      <div class="form-group">
        <label id="labelSILower" for="siLower">Social Insurance Lower Limit (CNY)</label>
        <input type="number" id="siLower" value="7460">
      </div>
      
      <div class="form-group">
        <label id="labelHFUpper" for="hfUpper">Housing Fund Upper Limit (CNY)</label>
        <input type="number" id="hfUpper" value="37302">
      </div>
      
      <div class="form-group">
        <label id="labelHFLower" for="hfLower">Housing Fund Lower Limit (CNY)</label>
        <input type="number" id="hfLower" value="7460">
      </div>

      <h3 id="benefitRatesHeader">Benefit Rates (Employer / Employee)</h3>
      <table>
        <thead>
          <tr>
            <th id="thCategory">Category</th>
            <th id="thEmployer">Employer %</th>
            <th id="thEmployee">Employee %</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <span id="tdPension">Pension Insurance</span>
              <span class="benefit-note" id="notePension"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="penE" value="16"></td>
            <td class="rate-input-cell"><input type="number" id="penP" value="8"></td>
          </tr>
          <tr>
            <td>
              <span id="tdMedical">Medical Insurance</span>
              <span class="benefit-note" id="noteMedical"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="medE" value="10"></td>
            <td class="rate-input-cell"><input type="number" id="medP" value="2"></td>
          </tr>
          <tr>
            <td>
              <span id="tdUnemployment">Unemployment Insurance</span>
              <span class="benefit-note" id="noteUnemployment"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="uneE" value="0.5"></td>
            <td class="rate-input-cell"><input type="number" id="uneP" value="0.5"></td>
          </tr>
          <tr>
            <td>
              <span id="tdWorkInjury">Work Injury Insurance</span>
              <span class="benefit-note" id="noteWorkInjury"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="injE" value="0.26"></td>
            <td class="rate-input-cell"><input type="number" id="injP" value="0"></td>
          </tr>
          <tr>
            <td>
              <span id="tdMaternity">Maternity Insurance</span>
              <span class="benefit-note" id="noteMaternity"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="matE" value="0"></td>
            <td class="rate-input-cell"><input type="number" id="matP" value="0"></td>
          </tr>
          <tr>
            <td>
              <span id="tdHousing">Housing Fund</span>
              <span class="benefit-note" id="noteHousing"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="houE" value="7"></td>
            <td class="rate-input-cell"><input type="number" id="houP" value="7"></td>
          </tr>
          <tr>
            <td>
              <span id="tdSupplementary">Supplementary HF (Optional)</span>
              <span class="benefit-note" id="noteSupplementary"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="supE" value="2"></td>
            <td class="rate-input-cell"><input type="number" id="supP" value="2"></td>
          </tr>
          <tr>
            <td>
              <span id="tdCorporate">Corporate Pension (Optional)</span>
              <span class="benefit-note" id="noteCorporate"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="corE" value="8"></td>
            <td class="rate-input-cell"><input type="number" id="corP" value="4"></td>
          </tr>
        </tbody>
      </table>

      <div class="form-group">
        <label id="labelCommercial" for="comE">Commercial Insurance (Optional, Employer, CNY/year)</label>
        <input type="number" id="comE" value="2000">
      </div>

      <h3 id="taxDeductionHeader">Tax Deduction Settings</h3>
      
      <div class="form-group">
        <label id="labelCorpPensionDeduction" for="corpPensionDeductionRate">Enterprise Annuity Pre-tax Deduction Rate (%)</label>
        <input type="number" id="corpPensionDeductionRate" value="67" min="0" max="100" step="1">
      </div>
    </section>

    <section class="results">
      <h2 id="resultsHeader">Results</h2>
      <div id="benefits"></div>
      <div id="summary"></div>
      
      <h3 id="taxTableHeader">12-Month Tax Table</h3>
      <table id="taxTable">
        <thead>
          <tr>
            <th id="thMonth">Month</th>
            <th id="thCumulative">Cumulative Taxable (¬•)</th>
            <th id="thRate">Rate %</th>
            <th id="thQuickDed">Quick Deduction</th>
            <th id="thTax">Tax (¬•)</th>
            <th id="thNetPay">Net Pay (¬•)</th>
            <th id="thNetPayUSD">Net Pay ($)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script>
    const cityConfig = {
      "cities": {
        "shanghai": {
          "meta": {
            "city_cn": "‰∏äÊµ∑",
            "year": 2025,
            "social_insurance_base": { "lower": 7460, "upper": 37302 },
            "housing_fund_base": { "lower": 2690, "upper": 37302 }
          },
          "benefits": {
            "pension": {
              "name": "Pension Insurance",
              "cn": "ÂÖªËÄÅ‰øùÈô©",
              "employer_rate": 0.16,
              "employee_rate": 0.08,
              "note_en": "",
              "note_cn": "‚Äå‚Äå"
            },
            "medical": {
              "name": "Medical Insurance",
              "cn": "ÂåªÁñó‰øùÈô©",
              "employer_rate": 0.09,
              "employee_rate": 0.02,
              "note_en": "",
              "note_cn": ""
            },
            "unemployment": {
              "name": "Unemployment Insurance",
              "cn": "Â§±‰∏ö‰øùÈô©",
              "employer_rate": 0.005,
              "employee_rate": 0.005,
              "note_en": "",
              "note_cn": ""
            },
            "work_injury": {
              "name": "Work Injury Insurance",
              "cn": "Â∑•‰º§‰øùÈô©",
              "employer_rate": 0.002,
              "employee_rate": 0,
              "note_en": "Rate varies by industry risk (0.2%‚Äì1.9%)",
              "note_cn": "Ë°å‰∏öÈ£éÈô©È´ò‰ΩéÂÜ≥ÂÆöË¥πÁéá (0.2%‚Äì1.9%)"
            },
            "maternity": {
              "name": "Maternity Insurance",
              "cn": "ÁîüËÇ≤‰øùÈô©",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Merged into medical insurance",
              "note_cn": "Â∑≤Âπ∂ÂÖ•ÂåªÁñó‰øùÈô©"
            },
            "housing_fund": {
              "name": "Housing Provident Fund",
              "cn": "‰ΩèÊàøÂÖ¨ÁßØÈáë",
              "employer_rate": 0.07,
              "employee_rate": 0.07,
              "range_allowed": [0.05, 0.07],
              "note_en": "Company-defined, same for employer and employee (5%-7%)",
              "note_cn": "‰ºÅ‰∏öÂèØËá™‰∏ªÈÄâÊã©ÔºåÂçï‰ΩçÂíå‰∏™‰∫∫ÊØî‰æãÁõ∏ÂêåÔºà5%-7%Ôºâ„ÄÇ‚Äå‚Äå"
            },
            "supplementary_housing": {
              "name": "Supplementary Housing Fund",
              "cn": "Ë°•ÂÖÖÂÖ¨ÁßØÈáë",
              "employer_rate": 0.02,
              "employee_rate": 0.02,
              "range_allowed": [0.01, 0.06],
              "note_en": "Company-defined, same for employer and employee (1%-6%)",
              "note_cn": "‰ºÅ‰∏öÂèØËá™‰∏ªÈÄâÊã©ÔºåÂçï‰ΩçÂíå‰∏™‰∫∫ÊØî‰æãÁõ∏ÂêåÔºà1%-6%Ôºâ„ÄÇ‚Äå‚Äå",
              "optional": true
            },
            "corporate_pension": {
              "name": "Corporate Pension",
              "cn": "‰ºÅ‰∏öÂπ¥Èáë",
              "employer_rate": 0.08,
              "employee_rate": 0.04,
              "note_en": "Company-defined",
              "note_cn": "Âçï‰ΩçÂíå‰∏™‰∫∫ÊØî‰æãÂèØ‰∏çÂêå",
              "optional": true,
              "base": "base_salary"
            },
            "commercial_insurance": {
              "name": "Group Commercial Insurance",
              "cn": "Âõ¢‰ΩìÂïÜ‰∏ö‰øùÈô©",
              "employer_paid": 2000,
              "unit": "CNY/year",
              "note_en": "Optional, enterprise-defined",
              "note_cn": "ÂèØÈÄâÔºå‰∏™‰∫∫‰∏çÈúÄË¶ÅÁº¥Á∫≥",
              "optional": true
            }
          }
        },
        "hangzhou": {
          "meta": {
            "city_cn": "Êù≠Â∑û",
            "year": 2025,
            "social_insurance_base": { "lower": 4986, "upper": 25299 },
            "housing_fund_base": { "lower": 2490, "upper": 40694 }
          },
          "benefits": {
            "pension": {
              "name": "Pension Insurance",
              "cn": "ÂÖªËÄÅ‰øùÈô©",
              "employer_rate": 0.14,
              "employee_rate": 0.08,
              "note_en": "Employer contribution: 14%-16%",
              "note_cn": "Âçï‰ΩçÊØî‰æãÔºö14%-16%‚Äå"
            },
            "medical": {
              "name": "Medical Insurance",
              "cn": "ÂåªÁñó‰øùÈô©",
              "employer_rate": 0.095,
              "employee_rate": 0.02,
              "note_en": "Employer contribution: 9.5%-10.5%",
              "note_cn": "Âçï‰ΩçÊØî‰æãÔºö9.5%-10.5%"
            },
            "unemployment": {
              "name": "Unemployment Insurance",
              "cn": "Â§±‰∏ö‰øùÈô©",
              "employer_rate": 0.005,
              "employee_rate": 0.005,
              "note_en": "",
              "note_cn": "‚Äå‚Äå"
            },
            "work_injury": {
              "name": "Work Injury Insurance",
              "cn": "Â∑•‰º§‰øùÈô©",
              "employer_rate": 0.002,
              "employee_rate": 0,
              "note_en": "Varies by industry (0.2%‚Äì0.8%)",
              "note_cn": "Ë°å‰∏öÈ£éÈô©È´ò‰ΩéÂÜ≥ÂÆöË¥πÁéá (0.2%‚Äì0.8%)"
            },
            "maternity": {
              "name": "Maternity Insurance",
              "cn": "ÁîüËÇ≤‰øùÈô©",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Merged into medical insurance",
              "note_cn": "Â∑≤Âπ∂ÂÖ•ÂåªÁñó‰øùÈô©"
            },
            "housing_fund": {
              "name": "Housing Provident Fund",
              "cn": "‰ΩèÊàøÂÖ¨ÁßØÈáë",
              "employer_rate": 0.12,
              "employee_rate": 0.12,
              "range_allowed": [0.05, 0.12],
              "note_en": "Company-defined, same for employer and employee (5%-12%)",
              "note_cn": "‰ºÅ‰∏öÂèØËá™‰∏ªÈÄâÊã©ÔºåÂçï‰ΩçÂíå‰∏™‰∫∫ÊØî‰æãÁõ∏ÂêåÔºà5%-12%Ôºâ„ÄÇ‚Äå‚Äå"
            },
            "supplementary_housing": {
              "name": "Supplementary Housing Fund",
              "cn": "Ë°•ÂÖÖÂÖ¨ÁßØÈáë",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Not applicable in Hangzhou",
              "note_cn": "Êù≠Â∑ûÊ≤°ÊúâË°•ÂÖÖÂÖ¨ÁßØÈáë‚Äå‚Äå",
              "optional": true
            },
            "corporate_pension": {
              "name": "Corporate Pension",
              "cn": "‰ºÅ‰∏öÂπ¥Èáë",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Company-defined",
              "note_cn": "Âçï‰ΩçÂíå‰∏™‰∫∫ÊØî‰æãÂèØ‰∏çÂêå",
              "optional": true,
              "base": "base_salary"
            },
            "commercial_insurance": {
              "name": "Group Commercial Insurance",
              "cn": "Âõ¢‰ΩìÂïÜ‰∏ö‰øùÈô©",
              "employer_paid": 0,
              "unit": "CNY/year",
              "note_en": "Optional, enterprise-defined",
              "note_cn": "ÂèØÈÄâÔºå‰∏™‰∫∫‰∏çÈúÄË¶ÅÁº¥Á∫≥",
              "optional": true
            }
          }
        }
      }
    };

    const translations = {
      en: {
        pageTitle: "China Benefit & Net Income Calculator",
        inputHeader: "Input",
        resultsHeader: "Results",
        labelSalaryUSD: "Base Salary (USD)",
        labelExchangeRate: "Exchange Rate (USD‚ÜíCNY)",
        labelSalaryRMB: "Base Salary (CNY)",
        labelCity: "City",
        limitsHeader: "Social Insurance / Housing Fund Limits (2025.7-2026.6)",
        labelSIUpper: "Social Insurance Upper Limit (CNY)",
        labelSILower: "Social Insurance Lower Limit (CNY)",
        labelHFUpper: "Housing Fund Upper Limit (CNY)",
        labelHFLower: "Housing Fund Lower Limit (CNY)",
        benefitRatesHeader: "Benefit Rates (Employer / Employee)",
        thCategory: "Category",
        thEmployer: "Employer %",
        thEmployee: "Employee %",
        tdPension: "Pension Insurance",
        tdMedical: "Medical Insurance",
        tdUnemployment: "Unemployment Insurance",
        tdWorkInjury: "Work Injury Insurance",
        tdMaternity: "Maternity Insurance",
        tdHousing: "Housing Fund",
        tdSupplementary: "Supplementary HF (Optional)",
        tdCorporate: "Corporate Pension (Optional)",
        labelCommercial: "Commercial Insurance (Optional, Employer, CNY/year)",
        taxTableHeader: "12-Month Tax Table",
        thMonth: "Month",
        thCumulative: "Cumulative Taxable (¬•)",
        thRate: "Rate %",
        thQuickDed: "Quick Deduction",
        thTax: "Tax (¬•)",
        thNetPay: "Net Pay (¬•)",
        thNetPayUSD: "Net Pay ($)",
        thTotal: "Total",
        benefitCalcHeader: "Benefit Calculation",
        benefitTableCategory: "Category",
        benefitTableBase: "Base",
        benefitTableEmployer: "Employer",
        benefitTableEmployee: "Employee",
        commercialInsuranceRow: "Commercial Insurance (Optional)",
        employerTotal: "Monthly Employer Total:",
        employeeTotal: "Monthly Employee Total:",
        monthlyTaxableIncome: "Monthly Taxable Income:",
        taxableFormulaPrefix: "(Base Salary ¬•",
        taxableFormulaMid1: " - Deductible Employee Benefits ¬•",
        taxableFormulaMid2: " - Standard Deduction ¬•",
        taxableFormulaSuffix: ")",
        taxDeductionHeader: "Tax Deduction Settings",
        labelCorpPensionDeduction: "Enterprise Annuity Pre-tax Deduction Rate (%)",
        employeeBenefitsBreakdown: "Deductible Employee Benefits Breakdown:",
        corpPensionTotal: "Corporate Pension (Total):",
        corpPensionDeductible: "Corporate Pension (Deductible):",
        corpPensionNonDeductible: "Corporate Pension (Non-deductible):",
        otherEmployeeBenefits: "Other Employee Benefits:",
        totalEmployeeBenefits: "Total Deductible Employee Benefits:",
        refreshRate: "Refresh"
      },
      zh: {
        pageTitle: "‰∏≠ÂõΩÁ§æ‰øùÂÖ¨ÁßØÈáëÂèäÁ®éÂêéÊî∂ÂÖ•ËÆ°ÁÆóÂô®",
        inputHeader: "ËæìÂÖ•",
        resultsHeader: "ÁªìÊûú",
        labelSalaryUSD: "Âü∫Êú¨Â∑•ËµÑ (ÁæéÂÖÉ)",
        labelExchangeRate: "Ê±áÁéá (USD‚ÜíCNY)",
        labelSalaryRMB: "Âü∫Êú¨Â∑•ËµÑ (CNY)",
        labelCity: "ÂüéÂ∏Ç",
        limitsHeader: "Á§æ‰øù / ÂÖ¨ÁßØÈáëÁº¥Ë¥πÂü∫Êï∞ÈôêÂà∂ (2025.7-2026.6)",
        labelSIUpper: "Á§æ‰øùÁº¥Ë¥πÂü∫Êï∞‰∏äÈôê (CNY)",
        labelSILower: "Á§æ‰øùÁº¥Ë¥πÂü∫Êï∞‰∏ãÈôê (CNY)",
        labelHFUpper: "ÂÖ¨ÁßØÈáëÁº¥Ë¥πÂü∫Êï∞‰∏äÈôê (CNY)",
        labelHFLower: "ÂÖ¨ÁßØÈáëÁº¥Ë¥πÂü∫Êï∞‰∏ãÈôê (CNY)",
        benefitRatesHeader: "Á¶èÂà©Áº¥Á∫≥ÊØî‰æã (Âçï‰Ωç / ‰∏™‰∫∫)",
        thCategory: "Á±ªÂà´",
        thEmployer: "Âçï‰Ωç %",
        thEmployee: "‰∏™‰∫∫ %",
        tdPension: "ÂÖªËÄÅ‰øùÈô©",
        tdMedical: "ÂåªÁñó‰øùÈô©",
        tdUnemployment: "Â§±‰∏ö‰øùÈô©",
        tdWorkInjury: "Â∑•‰º§‰øùÈô©",
        tdMaternity: "ÁîüËÇ≤‰øùÈô©",
        tdHousing: "‰ΩèÊàøÂÖ¨ÁßØÈáë",
        tdSupplementary: "Ë°•ÂÖÖÂÖ¨ÁßØÈáë (ÂèØÈÄâ)",
        tdCorporate: "‰ºÅ‰∏öÂπ¥Èáë (ÂèØÈÄâ)",
        labelCommercial: "ÂïÜ‰∏ö‰øùÈô© (ÂèØÈÄâÔºåÂçï‰ΩçÔºåCNY/Âπ¥)",
        taxTableHeader: "12‰∏™ÊúàÁ®éÈ¢ùË°®",
        thMonth: "Êúà‰ªΩ",
        thCumulative: "Á¥ØËÆ°Â∫îÁ®éÊî∂ÂÖ• (¬•)",
        thRate: "Á®éÁéá %",
        thQuickDed: "ÈÄüÁÆóÊâ£Èô§Êï∞",
        thTax: "Â∫îÁ∫≥Á®éÈ¢ù (¬•)",
        thNetPay: "Á®éÂêéÊî∂ÂÖ• (¬•)",
        thNetPayUSD: "Á®éÂêéÊî∂ÂÖ• ($)",
        thTotal: "ÊÄªËÆ°",
        benefitCalcHeader: "Á¶èÂà©ËÆ°ÁÆó",
        benefitTableCategory: "Á±ªÂà´",
        benefitTableBase: "Áº¥Ë¥πÂü∫Êï∞",
        benefitTableEmployer: "Âçï‰Ωç",
        benefitTableEmployee: "‰∏™‰∫∫",
        commercialInsuranceRow: "ÂïÜ‰∏ö‰øùÈô© (ÂèØÈÄâ)",
        employerTotal: "ÊúàÂ∫¶Âçï‰ΩçÂêàËÆ°:",
        employeeTotal: "ÊúàÂ∫¶‰∏™‰∫∫ÂêàËÆ°:",
        monthlyTaxableIncome: "ÊúàÂ∫¶Â∫îÁ®éÊî∂ÂÖ•:",
        taxableFormulaPrefix: "(Âü∫Êú¨Â∑•ËµÑ ¬•",
        taxableFormulaMid1: " - ÂèØÊâ£Èô§ÁöÑ‰∏™‰∫∫Á¶èÂà© ¬•",
        taxableFormulaMid2: " - Ê†áÂáÜÊâ£Èô§ ¬•",
        taxableFormulaSuffix: ")",
        taxDeductionHeader: "Á®éÂâçÊâ£Èô§ËÆæÁΩÆ",
        labelCorpPensionDeduction: "‰∏™‰∫∫Áº¥Á∫≥‰ºÅ‰∏öÂπ¥ÈáëÁ®éÂâçÊâ£Èô§ÊØî‰æã (%)",
        employeeBenefitsBreakdown: "ÂèØÊâ£Èô§ÁöÑ‰∏™‰∫∫Á¶èÂà©ÊòéÁªÜ:",
        corpPensionTotal: "‰ºÅ‰∏öÂπ¥Èáë (ÊÄªÈ¢ù):",
        corpPensionDeductible: "‰ºÅ‰∏öÂπ¥Èáë (ÂèØÊâ£Èô§):",
        corpPensionNonDeductible: "‰ºÅ‰∏öÂπ¥Èáë (‰∏çÂèØÊâ£Èô§):",
        otherEmployeeBenefits: "ÂÖ∂‰ªñ‰∏™‰∫∫Á¶èÂà©:",
        totalEmployeeBenefits: "ÂèØÊâ£Èô§ÁöÑ‰∏™‰∫∫Á¶èÂà©ÂêàËÆ°:",
        refreshRate: "Âà∑Êñ∞"
      }
    };

    let currentLanguage = 'en';

    const benefitNoteMapping = {
      'notePension': 'pension',
      'noteMedical': 'medical',
      'noteUnemployment': 'unemployment',
      'noteWorkInjury': 'work_injury',
      'noteMaternity': 'maternity',
      'noteHousing': 'housing_fund',
      'noteSupplementary': 'supplementary_housing',
      'noteCorporate': 'corporate_pension'
    };

    function updateBenefitNotes() {
      const city = citySelect.value;
      const config = cityConfig.cities[city];
      
      Object.keys(benefitNoteMapping).forEach(noteId => {
        const benefitKey = benefitNoteMapping[noteId];
        const benefit = config.benefits[benefitKey];
        const note = currentLanguage === 'zh' ? (benefit.note_cn || '') : (benefit.note_en || '');
        document.getElementById(noteId).innerText = note;
      });
    }

    function updateLanguage(lang) {
      currentLanguage = lang;
      const t = translations[lang];
      
      // Update all static text elements
      document.getElementById('pageTitle').innerText = t.pageTitle;
      document.getElementById('inputHeader').innerText = t.inputHeader;
      document.getElementById('resultsHeader').innerText = t.resultsHeader;
      document.getElementById('limitsHeader').innerText = t.limitsHeader;
      document.getElementById('benefitRatesHeader').innerText = t.benefitRatesHeader;
      document.getElementById('taxTableHeader').innerText = t.taxTableHeader;
      
      // Update labels (preserve input elements)
      document.getElementById('labelSalaryUSD').childNodes[0].nodeValue = t.labelSalaryUSD;
      document.getElementById('labelExchangeRate').childNodes[0].nodeValue = t.labelExchangeRate;
      document.getElementById('labelSalaryRMB').childNodes[0].nodeValue = t.labelSalaryRMB;
      document.getElementById('labelCity').childNodes[0].nodeValue = t.labelCity;
      document.getElementById('labelSIUpper').childNodes[0].nodeValue = t.labelSIUpper;
      document.getElementById('labelSILower').childNodes[0].nodeValue = t.labelSILower;
      document.getElementById('labelHFUpper').childNodes[0].nodeValue = t.labelHFUpper;
      document.getElementById('labelHFLower').childNodes[0].nodeValue = t.labelHFLower;
      document.getElementById('labelCommercial').childNodes[0].nodeValue = t.labelCommercial;
      document.getElementById('taxDeductionHeader').innerText = t.taxDeductionHeader;
      document.getElementById('labelCorpPensionDeduction').childNodes[0].nodeValue = t.labelCorpPensionDeduction;
      
      // Update table headers
      document.getElementById('thCategory').innerText = t.thCategory;
      document.getElementById('thEmployer').innerText = t.thEmployer;
      document.getElementById('thEmployee').innerText = t.thEmployee;
      
      // Update benefit categories
      document.getElementById('tdPension').innerText = t.tdPension;
      document.getElementById('tdMedical').innerText = t.tdMedical;
      document.getElementById('tdUnemployment').innerText = t.tdUnemployment;
      document.getElementById('tdWorkInjury').innerText = t.tdWorkInjury;
      document.getElementById('tdMaternity').innerText = t.tdMaternity;
      document.getElementById('tdHousing').innerText = t.tdHousing;
      document.getElementById('tdSupplementary').innerText = t.tdSupplementary;
      document.getElementById('tdCorporate').innerText = t.tdCorporate;
      
      // Update tax table headers
      document.getElementById('thMonth').innerText = t.thMonth;
      document.getElementById('thCumulative').innerText = t.thCumulative;
      document.getElementById('thRate').innerText = t.thRate;
      document.getElementById('thQuickDed').innerText = t.thQuickDed;
      document.getElementById('thTax').innerText = t.thTax;
      document.getElementById('thNetPay').innerText = t.thNetPay;
      document.getElementById('thNetPayUSD').innerText = t.thNetPayUSD;
      
      // Update benefit notes
      updateBenefitNotes();
      
      // Update refresh button text
      document.getElementById('refreshText').innerText = t.refreshRate;
      
      // Recalculate to update dynamic content
      calculate();
    }

    const rateInput = document.getElementById('rate');
    const salaryUSD = document.getElementById('salaryUSD');
    const salaryRMB = document.getElementById('salaryRMB');
    const citySelect = document.getElementById('city');
    const languageSelect = document.getElementById('languageSelect');

    function syncCurrency(e){
      const rate = parseFloat(rateInput.value)||7.12;
      if(e.target===salaryUSD){ 
        salaryRMB.value=(salaryUSD.value*rate).toFixed(2); 
      }
      else if(e.target===salaryRMB){ 
        salaryUSD.value=(salaryRMB.value/rate).toFixed(2); 
      }
      else if(e.target===rateInput){
        // When exchange rate changes, update CNY salary based on current USD salary
        salaryRMB.value=(salaryUSD.value*rate).toFixed(2);
      }
      calculate();
    }
    rateInput.addEventListener('input', syncCurrency);
    salaryUSD.addEventListener('input', syncCurrency);
    salaryRMB.addEventListener('input', syncCurrency);

    // Language selector
    languageSelect.addEventListener('change', function() {
      updateLanguage(this.value);
    });

    // Update form values when city changes
    function loadCityConfig(){
      const city = citySelect.value;
      const config = cityConfig.cities[city];
      
      // Update base limits
      document.getElementById('siUpper').value = config.meta.social_insurance_base.upper;
      document.getElementById('siLower').value = config.meta.social_insurance_base.lower;
      document.getElementById('hfUpper').value = config.meta.housing_fund_base.upper;
      document.getElementById('hfLower').value = config.meta.housing_fund_base.lower;
      
      // Update benefit rates
      document.getElementById('penE').value = parseFloat((config.benefits.pension.employer_rate * 100).toFixed(2));
      document.getElementById('penP').value = parseFloat((config.benefits.pension.employee_rate * 100).toFixed(2));
      document.getElementById('medE').value = parseFloat((config.benefits.medical.employer_rate * 100).toFixed(2));
      document.getElementById('medP').value = parseFloat((config.benefits.medical.employee_rate * 100).toFixed(2));
      document.getElementById('uneE').value = parseFloat((config.benefits.unemployment.employer_rate * 100).toFixed(2));
      document.getElementById('uneP').value = parseFloat((config.benefits.unemployment.employee_rate * 100).toFixed(2));
      document.getElementById('injE').value = parseFloat((config.benefits.work_injury.employer_rate * 100).toFixed(2));
      document.getElementById('injP').value = parseFloat((config.benefits.work_injury.employee_rate * 100).toFixed(2));
      document.getElementById('matE').value = parseFloat((config.benefits.maternity.employer_rate * 100).toFixed(2));
      document.getElementById('matP').value = parseFloat((config.benefits.maternity.employee_rate * 100).toFixed(2));
      document.getElementById('houE').value = parseFloat((config.benefits.housing_fund.employer_rate * 100).toFixed(2));
      document.getElementById('houP').value = parseFloat((config.benefits.housing_fund.employee_rate * 100).toFixed(2));
      document.getElementById('supE').value = parseFloat((config.benefits.supplementary_housing.employer_rate * 100).toFixed(2));
      document.getElementById('supP').value = parseFloat((config.benefits.supplementary_housing.employee_rate * 100).toFixed(2));
      document.getElementById('corE').value = parseFloat((config.benefits.corporate_pension.employer_rate * 100).toFixed(2));
      document.getElementById('corP').value = parseFloat((config.benefits.corporate_pension.employee_rate * 100).toFixed(2));
      document.getElementById('comE').value = config.benefits.commercial_insurance.employer_paid;
      
      // Update benefit notes
      updateBenefitNotes();
      
      calculate();
    }
    
    citySelect.addEventListener('change', loadCityConfig);

    const taxBrackets=[
      {max:36000,rate:0.03,ded:0},
      {max:144000,rate:0.10,ded:2520},
      {max:300000,rate:0.20,ded:16920},
      {max:420000,rate:0.25,ded:31920},
      {max:660000,rate:0.30,ded:52920},
      {max:960000,rate:0.35,ded:85920},
      {max:Infinity,rate:0.45,ded:181920}
    ];

    const ids=['pen','med','une','inj','mat','hou','sup','cor'];
    const idNames={
      'pen':'Pension Insurance',
      'med':'Medical Insurance', 
      'une':'Unemployment Insurance',
      'inj':'Work Injury Insurance',
      'mat':'Maternity Insurance',
      'hou':'Housing Fund',
      'sup':'Supplementary HF (Optional)',
      'cor':'Corporate Pension (Optional)'
    };
    const idToElementId={
      'pen':'tdPension',
      'med':'tdMedical',
      'une':'tdUnemployment',
      'inj':'tdWorkInjury',
      'mat':'tdMaternity',
      'hou':'tdHousing',
      'sup':'tdSupplementary',
      'cor':'tdCorporate'
    };

    // Format number with thousand separators
    function formatAmount(num, decimals = 0) {
      return num.toLocaleString('en-US', {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function calculate(){
      const base=parseFloat(salaryRMB.value)||0;
      const siU=parseFloat(siUpper.value),siL=parseFloat(siLower.value);
      const hfU=parseFloat(hfUpper.value),hfL=parseFloat(hfLower.value);

      let siBase=Math.min(Math.max(base,siL),siU);
      let hfBase=Math.min(Math.max(base,hfL),hfU);

      // Get current city config for extra fixed amounts
      const city = citySelect.value;
      const config = cityConfig.cities[city];

      // Get translations for current language
      const t = translations[currentLanguage];

      const rate = parseFloat(rateInput.value)||7.12;
      
      let empE=0, empP=0;
      let corpPensionEmployeeAmt = 0; // Track corporate pension employee contribution separately
      let details=`<h3>${t.benefitCalcHeader}</h3><table><tr><th>${t.benefitTableCategory}</th><th>${t.benefitTableBase}</th><th>${t.benefitTableEmployer} (¬•)</th><th>${t.benefitTableEmployer} ($)</th><th>${t.benefitTableEmployee} (¬•)</th><th>${t.benefitTableEmployee} ($)</th></tr>`;
      ids.forEach(id=>{
        const e=document.getElementById(id+'E').value/100;
        const p=document.getElementById(id+'P').value/100;
        let b=(id==='hou'||id==='sup')?hfBase:(id==='cor'?base:siBase);
        const eAmt=b*e;
        let pAmt=b*p;
        
        empE+=eAmt;
        empP+=pAmt;
        
        // Track corporate pension employee contribution
        if(id === 'cor') {
          corpPensionEmployeeAmt = pAmt;
        }
        
        // Use translated category name
        const categoryName = document.getElementById(idToElementId[id]).innerText;
        
        details+=`<tr><td>${categoryName}</td><td>${formatAmount(b)}</td><td>${formatAmount(eAmt)}</td><td>${formatAmount(eAmt/rate)}</td><td>${formatAmount(pAmt)}</td><td>${formatAmount(pAmt/rate)}</td></tr>`;
      });

      const comE=parseFloat(document.getElementById('comE').value)||0;
      const comEMonthly=comE/12;
      empE+=comEMonthly;
      
      // Add commercial insurance row to the table
      if(comE > 0){
        details+=`<tr><td>${t.commercialInsuranceRow}</td><td>${formatAmount(comE)}/year</td><td>${formatAmount(comEMonthly)}</td><td>${formatAmount(comEMonthly/rate)}</td><td>0</td><td>0</td></tr>`;
      }

      // Add total row
      details+=`<tr style="font-weight: bold; background-color: #f8fafc;"><td><b>${t.thTotal}</b></td><td></td><td><b>${formatAmount(empE)}</b></td><td><b>${formatAmount(empE/rate)}</b></td><td><b>${formatAmount(empP)}</b></td><td><b>${formatAmount(empP/rate)}</b></td></tr>`;

      details+="</table>";
      document.getElementById('benefits').innerHTML=details;

      const standardDeduction=5000;
      
      // Apply enterprise annuity pre-tax deduction rate
      const corpPensionDeductionRate = parseFloat(document.getElementById('corpPensionDeductionRate').value) || 67;
      const corpPensionDeductibleAmt = corpPensionEmployeeAmt * (corpPensionDeductionRate / 100);
      const corpPensionNonDeductibleAmt = corpPensionEmployeeAmt - corpPensionDeductibleAmt;
      
      // Monthly taxable = Base - Standard Deduction - (Employee Benefits - Corp Pension + Corp Pension * Deduction Rate)
      // Which simplifies to: Base - Standard Deduction - Employee Benefits + Corp Pension * (1 - Deduction Rate)
      const monthlyTaxable=Math.max(base-standardDeduction-empP+corpPensionNonDeductibleAmt,0);

      let tbody=document.querySelector('#taxTable tbody');
      tbody.innerHTML='';
      let prevTax=0;
      let totalTaxAmount=0;
      let totalNetPayAmount=0;
      for(let m=1;m<=12;m++){
        const cum=monthlyTaxable*m;
        const br=taxBrackets.find(b=>cum<=b.max);
        const totalTax=cum*br.rate-br.ded;
        const monthTax=Math.max(totalTax-prevTax,0);
        prevTax=totalTax;
        const net=monthlyTaxable-monthTax;
        totalTaxAmount+=monthTax;
        totalNetPayAmount+=net;
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${m}</td><td>${formatAmount(cum)}</td><td>${(br.rate*100).toFixed(0)}%</td><td>${formatAmount(br.ded, 0)}</td><td>${formatAmount(monthTax)}</td><td>${formatAmount(net)}</td><td>${formatAmount(net/rate)}</td>`;
        tbody.appendChild(tr);
      }
      
      // Add total row
      const totalRow=document.createElement('tr');
      totalRow.style.fontWeight='bold';
      totalRow.style.backgroundColor='#f8fafc';
      totalRow.innerHTML=`<td><b>${t.thTotal}</b></td><td></td><td></td><td></td><td><b>${formatAmount(totalTaxAmount)}</b></td><td><b>${formatAmount(totalNetPayAmount)}</b></td><td><b>${formatAmount(totalNetPayAmount/rate)}</b></td>`;
      tbody.appendChild(totalRow);

      // Calculate the adjusted employee benefits for display (subtract non-deductible portion)
      const adjustedEmpP = empP - corpPensionNonDeductibleAmt;
      
      // Calculate other employee benefits (excluding corporate pension)
      const otherEmployeeBenefitsAmt = empP - corpPensionEmployeeAmt;
      
      document.getElementById('summary').innerHTML=
        `<div class="summary-box">
          <p><b>${t.employerTotal}</b> ¬•${formatAmount(empE)} ($${formatAmount(empE/rate)})</p>
          <p><b>${t.employeeTotal}</b> ¬•${formatAmount(empP)} ($${formatAmount(empP/rate)})</p>
          <p><b>${t.monthlyTaxableIncome}</b> ¬•${formatAmount(monthlyTaxable)} ($${formatAmount(monthlyTaxable/rate)})
            <small>${t.taxableFormulaPrefix}${formatAmount(base)}${t.taxableFormulaMid1}${formatAmount(adjustedEmpP)}${t.taxableFormulaMid2}${formatAmount(standardDeduction, 0)}${t.taxableFormulaSuffix}</small>
          </p>
          <div style="margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; border-left: 3px solid #3b82f6;">
            <p style="margin-bottom: 0.5rem; font-weight: 600; color: #1e40af;">${t.employeeBenefitsBreakdown}</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem;"><b>${t.corpPensionTotal}</b> ¬•${formatAmount(corpPensionEmployeeAmt)}</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem; color: #059669;"><b>${t.corpPensionDeductible}</b> ¬•${formatAmount(corpPensionDeductibleAmt)} - ${corpPensionDeductionRate}%</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem; color: #dc2626;"><b>${t.corpPensionNonDeductible}</b> ¬•${formatAmount(corpPensionNonDeductibleAmt)} - ${100-corpPensionDeductionRate}%</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem;"><b>${t.otherEmployeeBenefits}</b> ¬•${formatAmount(otherEmployeeBenefitsAmt)}</p>
            <p style="margin: 0.5rem 0 0 0; font-weight: 600; color: #1e40af; border-top: 1px solid #e5e7eb; padding-top: 0.5rem;"><b>${t.totalEmployeeBenefits}</b> ¬•${formatAmount(adjustedEmpP)} ($${formatAmount(adjustedEmpP/rate)})</p>
          </div>
        </div>`;
    }

    document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input',calculate));
    
    // Exchange rate functionality
    const refreshRateBtn = document.getElementById('refreshRateBtn');
    const refreshIcon = document.getElementById('refreshIcon');
    const refreshText = document.getElementById('refreshText');
    const rateStatus = document.getElementById('rateStatus');
    
    // Function to fetch exchange rate
    async function fetchExchangeRate() {
      try {
        setLoadingState(true);
        rateStatus.textContent = 'Loading exchange rate...';
        
        // Try multiple APIs for better reliability
        const apis = [
          'https://api.exchangerate-api.com/v4/latest/USD',
          'https://api.fixer.io/latest?base=USD&symbols=CNY',
          'https://api.currencyapi.com/v3/latest?apikey=free&currencies=CNY&base_currency=USD'
        ];
        
        for (const apiUrl of apis) {
          try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('API error');
            
            const data = await response.json();
            let rate = null;
            
            // Parse different API response formats
            if (data.rates && data.rates.CNY) {
              rate = data.rates.CNY;
            } else if (data.data && data.data.CNY) {
              rate = data.data.CNY.value;
            }
            
            if (rate && rate > 0) {
              rateInput.value = parseFloat(rate.toFixed(4));
              rateStatus.textContent = `Updated: ${new Date().toLocaleString()}`;
              rateStatus.style.color = 'var(--success)';
              // Trigger currency sync to update CNY salary based on current USD salary
              syncCurrency({ target: rateInput });
              return;
            }
          } catch (error) {
            console.log(`API ${apiUrl} failed:`, error);
            continue;
          }
        }
        
        throw new Error('All APIs failed');
        
      } catch (error) {
        console.error('Failed to fetch exchange rate:', error);
        rateStatus.textContent = 'Failed to load rate. Using default.';
        rateStatus.style.color = 'var(--text-secondary)';
      } finally {
        setLoadingState(false);
      }
    }
    
    // Function to set loading state
    function setLoadingState(loading) {
      if (loading) {
        refreshIcon.textContent = '‚è≥';
        refreshIcon.style.animation = 'spin 1s linear infinite';
        refreshRateBtn.disabled = true;
        refreshRateBtn.style.opacity = '0.7';
      } else {
        refreshIcon.textContent = 'üîÑ';
        refreshIcon.style.animation = 'none';
        refreshRateBtn.disabled = false;
        refreshRateBtn.style.opacity = '1';
      }
    }
    
    // Add CSS animation for loading spinner
    const style = document.createElement('style');
    style.textContent = `
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `;
    document.head.appendChild(style);
    
    // Event listener for refresh button
    refreshRateBtn.addEventListener('click', fetchExchangeRate);
    
    // Load exchange rate on page load
    fetchExchangeRate();
    
    // Load initial city config
    loadCityConfig();
  </script>
</body>
</html>