<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>China Benefit & Net Income Calculator</title>
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-dark: #1e40af;
      --secondary-color: #64748b;
      --background: #f8fafc;
      --surface: #ffffff;
      --border: #e2e8f0;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --success: #10b981;
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 0.75rem;
      --spacing-lg: 1rem;
      --spacing-xl: 1.25rem;
      --radius-sm: 0.25rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 4px 6px -2px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.4;
      padding: var(--spacing-sm);
    }

    header {
      max-width: 1400px;
      margin: 0 auto var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    h1 {
      font-size: clamp(1.25rem, 3vw, 1.75rem);
      font-weight: 700;
      color: var(--primary-color);
      flex: 1;
      min-width: 200px;
    }

    .language-selector {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    main {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 450px), 1fr));
      gap: var(--spacing-md);
    }

    section {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: var(--spacing-md);
      box-shadow: var(--shadow-md);
    }

    h2 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
      padding-bottom: var(--spacing-xs);
      border-bottom: 2px solid var(--primary-color);
    }

    h3 {
      font-size: 0.95rem;
      font-weight: 600;
      margin: var(--spacing-md) 0 var(--spacing-sm);
      color: var(--text-primary);
    }

    .form-group {
      margin-bottom: var(--spacing-sm);
    }

    label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.125rem;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 0.4rem 0.6rem;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      transition: all 0.2s ease;
      background: var(--surface);
    }

    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    input[type="number"]:hover,
    select:hover {
      border-color: var(--primary-dark);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--spacing-sm);
      font-size: 0.8rem;
      overflow-x: auto;
      display: block;
    }

    thead {
      display: table;
      width: 100%;
      table-layout: fixed;
    }

    tbody {
      display: table;
      width: 100%;
      table-layout: fixed;
    }

    th {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      font-weight: 600;
      padding: 0.4rem 0.5rem;
      text-align: right;
      font-size: 0.75rem;
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    td {
      border: 1px solid var(--border);
      padding: 0.4rem 0.5rem;
      text-align: right;
    }

    tbody tr:hover {
      background: var(--background);
    }

    .rate-input-cell {
      padding: 0.15rem;
    }

    .rate-input-cell input {
      padding: 0.25rem 0.4rem;
      font-size: 0.8rem;
      text-align: center;
    }

    .benefit-note {
      font-size: 0.7rem;
      color: var(--text-secondary);
      font-style: italic;
      display: block;
      margin-top: 0.125rem;
    }

    .summary-box {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-left: 4px solid var(--primary-color);
      padding: var(--spacing-sm);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-sm);
    }

    .summary-box p {
      margin-bottom: var(--spacing-xs);
    }

    .summary-box b {
      color: var(--primary-color);
    }

    .summary-box small {
      color: var(--text-secondary);
      display: block;
      margin-top: 0.125rem;
    }

    @media (max-width: 768px) {
      body {
        padding: 0.25rem;
      }

      section {
        padding: var(--spacing-sm);
      }

      h1 {
        font-size: 1.25rem;
      }

      table {
        font-size: 0.7rem;
      }

      th, td {
        padding: 0.25rem;
      }
    }

    @media (max-width: 480px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
      }

      .language-selector {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="pageTitle">China Benefit & Net Income Calculator</h1>
    <div class="language-selector">
      <label for="languageSelect">Language / 语言:</label>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="zh">中文</option>
      </select>
    </div>
  </header>
  <main>
    <section class="inputs">
      <h2 id="inputHeader">Input</h2>
      
      <div class="form-group">
        <label id="labelSalaryUSD" for="salaryUSD">Base Salary (USD)</label>
        <input type="number" id="salaryUSD" value="14044.94">
      </div>
      
      <div class="form-group">
        <label id="labelExchangeRate" for="rate">Exchange Rate (USD→RMB)</label>
        <input type="number" id="rate" value="7.12" step="0.01">
      </div>
      
      <div class="form-group">
        <label id="labelSalaryRMB" for="salaryRMB">Base Salary (RMB)</label>
        <input type="number" id="salaryRMB" value="100000">
      </div>
      
      <div class="form-group">
        <label id="labelCity" for="city">City</label>
        <select id="city">
          <option value="shanghai">Shanghai / 上海</option>
          <option value="hangzhou">Hangzhou / 杭州</option>
        </select>
      </div>

      <h3 id="limitsHeader">Social Insurance / Housing Fund Limits (2025.7-2026.6)</h3>
      
      <div class="form-group">
        <label id="labelSIUpper" for="siUpper">Social Insurance Upper Limit (RMB)</label>
        <input type="number" id="siUpper" value="37302">
      </div>
      
      <div class="form-group">
        <label id="labelSILower" for="siLower">Social Insurance Lower Limit (RMB)</label>
        <input type="number" id="siLower" value="7460">
      </div>
      
      <div class="form-group">
        <label id="labelHFUpper" for="hfUpper">Housing Fund Upper Limit (RMB)</label>
        <input type="number" id="hfUpper" value="37302">
      </div>
      
      <div class="form-group">
        <label id="labelHFLower" for="hfLower">Housing Fund Lower Limit (RMB)</label>
        <input type="number" id="hfLower" value="7460">
      </div>

      <h3 id="benefitRatesHeader">Benefit Rates (Employer / Employee)</h3>
      <table>
        <thead>
          <tr>
            <th id="thCategory">Category</th>
            <th id="thEmployer">Employer %</th>
            <th id="thEmployee">Employee %</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <span id="tdPension">Pension Insurance</span>
              <span class="benefit-note" id="notePension"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="penE" value="16"></td>
            <td class="rate-input-cell"><input type="number" id="penP" value="8"></td>
          </tr>
          <tr>
            <td>
              <span id="tdMedical">Medical Insurance</span>
              <span class="benefit-note" id="noteMedical"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="medE" value="10"></td>
            <td class="rate-input-cell"><input type="number" id="medP" value="2"></td>
          </tr>
          <tr>
            <td>
              <span id="tdUnemployment">Unemployment Insurance</span>
              <span class="benefit-note" id="noteUnemployment"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="uneE" value="0.5"></td>
            <td class="rate-input-cell"><input type="number" id="uneP" value="0.5"></td>
          </tr>
          <tr>
            <td>
              <span id="tdWorkInjury">Work Injury Insurance</span>
              <span class="benefit-note" id="noteWorkInjury"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="injE" value="0.26"></td>
            <td class="rate-input-cell"><input type="number" id="injP" value="0"></td>
          </tr>
          <tr>
            <td>
              <span id="tdMaternity">Maternity Insurance</span>
              <span class="benefit-note" id="noteMaternity"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="matE" value="0"></td>
            <td class="rate-input-cell"><input type="number" id="matP" value="0"></td>
          </tr>
          <tr>
            <td>
              <span id="tdHousing">Housing Fund</span>
              <span class="benefit-note" id="noteHousing"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="houE" value="7"></td>
            <td class="rate-input-cell"><input type="number" id="houP" value="7"></td>
          </tr>
          <tr>
            <td>
              <span id="tdSupplementary">Supplementary HF (Optional)</span>
              <span class="benefit-note" id="noteSupplementary"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="supE" value="2"></td>
            <td class="rate-input-cell"><input type="number" id="supP" value="2"></td>
          </tr>
          <tr>
            <td>
              <span id="tdCorporate">Corporate Pension (Optional)</span>
              <span class="benefit-note" id="noteCorporate"></span>
            </td>
            <td class="rate-input-cell"><input type="number" id="corE" value="8"></td>
            <td class="rate-input-cell"><input type="number" id="corP" value="4"></td>
          </tr>
        </tbody>
      </table>

      <div class="form-group">
        <label id="labelCommercial" for="comE">Commercial Insurance (Optional, Employer, RMB/year)</label>
        <input type="number" id="comE" value="2000">
      </div>

      <h3 id="taxDeductionHeader">Tax Deduction Settings</h3>
      
      <div class="form-group">
        <label id="labelCorpPensionDeduction" for="corpPensionDeductionRate">Enterprise Annuity Pre-tax Deduction Rate (%)</label>
        <input type="number" id="corpPensionDeductionRate" value="67" min="0" max="100" step="1">
      </div>
    </section>

    <section class="results">
      <h2 id="resultsHeader">Results</h2>
      <div id="benefits"></div>
      <div id="summary"></div>
      
      <h3 id="taxTableHeader">12-Month Tax Table</h3>
      <table id="taxTable">
        <thead>
          <tr>
            <th id="thMonth">Month</th>
            <th id="thCumulative">Cumulative Taxable (¥)</th>
            <th id="thRate">Rate %</th>
            <th id="thQuickDed">Quick Deduction</th>
            <th id="thTax">Tax (¥)</th>
            <th id="thNetPay">Net Pay (¥)</th>
            <th id="thNetPayUSD">Net Pay (USD)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script>
    const cityConfig = {
      "cities": {
        "shanghai": {
          "meta": {
            "city_cn": "上海",
            "year": 2025,
            "social_insurance_base": { "lower": 7460, "upper": 37302 },
            "housing_fund_base": { "lower": 2690, "upper": 37302 }
          },
          "benefits": {
            "pension": {
              "name": "Pension Insurance",
              "cn": "养老保险",
              "employer_rate": 0.16,
              "employee_rate": 0.08,
              "note_en": "",
              "note_cn": "‌‌"
            },
            "medical": {
              "name": "Medical Insurance",
              "cn": "医疗保险",
              "employer_rate": 0.09,
              "employee_rate": 0.02,
              "note_en": "",
              "note_cn": ""
            },
            "unemployment": {
              "name": "Unemployment Insurance",
              "cn": "失业保险",
              "employer_rate": 0.005,
              "employee_rate": 0.005,
              "note_en": "",
              "note_cn": ""
            },
            "work_injury": {
              "name": "Work Injury Insurance",
              "cn": "工伤保险",
              "employer_rate": 0.002,
              "employee_rate": 0,
              "note_en": "Rate varies by industry risk (0.2%–1.9%)",
              "note_cn": "行业风险高低决定费率 (0.2%–1.9%)"
            },
            "maternity": {
              "name": "Maternity Insurance",
              "cn": "生育保险",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Merged into medical insurance",
              "note_cn": "已并入医疗保险"
            },
            "housing_fund": {
              "name": "Housing Provident Fund",
              "cn": "住房公积金",
              "employer_rate": 0.07,
              "employee_rate": 0.07,
              "range_allowed": [0.05, 0.07],
              "note_en": "Company-defined, same for employer and employee (5%-7%)",
              "note_cn": "企业可自主选择，单位和个人比例相同（5%-7%）。‌‌"
            },
            "supplementary_housing": {
              "name": "Supplementary Housing Fund",
              "cn": "补充公积金",
              "employer_rate": 0.02,
              "employee_rate": 0.02,
              "range_allowed": [0.01, 0.06],
              "note_en": "Company-defined, same for employer and employee (1%-6%)",
              "note_cn": "企业可自主选择，单位和个人比例相同（1%-6%）。‌‌",
              "optional": true
            },
            "corporate_pension": {
              "name": "Corporate Pension",
              "cn": "企业年金",
              "employer_rate": 0.08,
              "employee_rate": 0.04,
              "note_en": "Company-defined",
              "note_cn": "单位和个人比例可不同",
              "optional": true,
              "base": "base_salary"
            },
            "commercial_insurance": {
              "name": "Group Commercial Insurance",
              "cn": "团体商业保险",
              "employer_paid": 2000,
              "unit": "CNY/year",
              "note_en": "Optional, enterprise-defined",
              "note_cn": "可选，个人不需要缴纳",
              "optional": true
            }
          }
        },
        "hangzhou": {
          "meta": {
            "city_cn": "杭州",
            "year": 2025,
            "social_insurance_base": { "lower": 4986, "upper": 25299 },
            "housing_fund_base": { "lower": 2490, "upper": 40694 }
          },
          "benefits": {
            "pension": {
              "name": "Pension Insurance",
              "cn": "养老保险",
              "employer_rate": 0.14,
              "employee_rate": 0.08,
              "note_en": "Employer contribution: 14%-16%",
              "note_cn": "单位比例：14%-16%‌"
            },
            "medical": {
              "name": "Medical Insurance",
              "cn": "医疗保险",
              "employer_rate": 0.095,
              "employee_rate": 0.02,
              "note_en": "Employer contribution: 9.5%-10.5%",
              "note_cn": "单位比例：9.5%-10.5%"
            },
            "unemployment": {
              "name": "Unemployment Insurance",
              "cn": "失业保险",
              "employer_rate": 0.005,
              "employee_rate": 0.005,
              "note_en": "",
              "note_cn": "‌‌"
            },
            "work_injury": {
              "name": "Work Injury Insurance",
              "cn": "工伤保险",
              "employer_rate": 0.002,
              "employee_rate": 0,
              "note_en": "Varies by industry (0.2%–0.8%)",
              "note_cn": "行业风险高低决定费率 (0.2%–0.8%)"
            },
            "maternity": {
              "name": "Maternity Insurance",
              "cn": "生育保险",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Merged into medical insurance",
              "note_cn": "已并入医疗保险"
            },
            "housing_fund": {
              "name": "Housing Provident Fund",
              "cn": "住房公积金",
              "employer_rate": 0.12,
              "employee_rate": 0.12,
              "range_allowed": [0.05, 0.12],
              "note_en": "Company-defined, same for employer and employee (5%-12%)",
              "note_cn": "企业可自主选择，单位和个人比例相同（5%-12%）。‌‌"
            },
            "supplementary_housing": {
              "name": "Supplementary Housing Fund",
              "cn": "补充公积金",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Not applicable in Hangzhou",
              "note_cn": "杭州没有补充公积金‌‌",
              "optional": true
            },
            "corporate_pension": {
              "name": "Corporate Pension",
              "cn": "企业年金",
              "employer_rate": 0,
              "employee_rate": 0,
              "note_en": "Company-defined",
              "note_cn": "单位和个人比例可不同",
              "optional": true,
              "base": "base_salary"
            },
            "commercial_insurance": {
              "name": "Group Commercial Insurance",
              "cn": "团体商业保险",
              "employer_paid": 0,
              "unit": "CNY/year",
              "note_en": "Optional, enterprise-defined",
              "note_cn": "可选，个人不需要缴纳",
              "optional": true
            }
          }
        }
      }
    };

    const translations = {
      en: {
        pageTitle: "China Benefit & Net Income Calculator",
        inputHeader: "Input",
        resultsHeader: "Results",
        labelSalaryUSD: "Base Salary (USD)",
        labelExchangeRate: "Exchange Rate (USD→RMB)",
        labelSalaryRMB: "Base Salary (RMB)",
        labelCity: "City",
        limitsHeader: "Social Insurance / Housing Fund Limits (2025.7-2026.6)",
        labelSIUpper: "Social Insurance Upper Limit (RMB)",
        labelSILower: "Social Insurance Lower Limit (RMB)",
        labelHFUpper: "Housing Fund Upper Limit (RMB)",
        labelHFLower: "Housing Fund Lower Limit (RMB)",
        benefitRatesHeader: "Benefit Rates (Employer / Employee)",
        thCategory: "Category",
        thEmployer: "Employer %",
        thEmployee: "Employee %",
        tdPension: "Pension Insurance",
        tdMedical: "Medical Insurance",
        tdUnemployment: "Unemployment Insurance",
        tdWorkInjury: "Work Injury Insurance",
        tdMaternity: "Maternity Insurance",
        tdHousing: "Housing Fund",
        tdSupplementary: "Supplementary HF (Optional)",
        tdCorporate: "Corporate Pension (Optional)",
        labelCommercial: "Commercial Insurance (Optional, Employer, RMB/year)",
        taxTableHeader: "12-Month Tax Table",
        thMonth: "Month",
        thCumulative: "Cumulative Taxable (¥)",
        thRate: "Rate %",
        thQuickDed: "Quick Deduction",
        thTax: "Tax (¥)",
        thNetPay: "Net Pay (¥)",
        thNetPayUSD: "Net Pay (USD)",
        benefitCalcHeader: "Benefit Calculation",
        benefitTableCategory: "Category",
        benefitTableBase: "Base",
        benefitTableEmployer: "Employer ¥",
        benefitTableEmployee: "Employee ¥",
        commercialInsuranceRow: "Commercial Insurance (Optional)",
        employerTotal: "Monthly Employer Total:",
        employeeTotal: "Monthly Employee Total:",
        monthlyTaxableIncome: "Monthly Taxable Income:",
        taxableFormulaPrefix: "(Base Salary ¥",
        taxableFormulaMid1: " - Deductible Employee Benefits ¥",
        taxableFormulaMid2: " - Standard Deduction ¥",
        taxableFormulaSuffix: ")",
        taxDeductionHeader: "Tax Deduction Settings",
        labelCorpPensionDeduction: "Enterprise Annuity Pre-tax Deduction Rate (%)",
        employeeBenefitsBreakdown: "Deductible Employee Benefits Breakdown:",
        corpPensionTotal: "Corporate Pension (Total):",
        corpPensionDeductible: "Corporate Pension (Deductible):",
        corpPensionNonDeductible: "Corporate Pension (Non-deductible):",
        otherEmployeeBenefits: "Other Employee Benefits:",
        totalEmployeeBenefits: "Total Deductible Employee Benefits:"
      },
      zh: {
        pageTitle: "中国社保公积金及税后收入计算器",
        inputHeader: "输入",
        resultsHeader: "结果",
        labelSalaryUSD: "基本工资 (美元)",
        labelExchangeRate: "汇率 (USD→RMB)",
        labelSalaryRMB: "基本工资 (人民币)",
        labelCity: "城市",
        limitsHeader: "社保 / 公积金缴费基数限制 (2025.7-2026.6)",
        labelSIUpper: "社保缴费基数上限 (人民币)",
        labelSILower: "社保缴费基数下限 (人民币)",
        labelHFUpper: "公积金缴费基数上限 (人民币)",
        labelHFLower: "公积金缴费基数下限 (人民币)",
        benefitRatesHeader: "福利缴纳比例 (单位 / 个人)",
        thCategory: "类别",
        thEmployer: "单位 %",
        thEmployee: "个人 %",
        tdPension: "养老保险",
        tdMedical: "医疗保险",
        tdUnemployment: "失业保险",
        tdWorkInjury: "工伤保险",
        tdMaternity: "生育保险",
        tdHousing: "住房公积金",
        tdSupplementary: "补充公积金 (可选)",
        tdCorporate: "企业年金 (可选)",
        labelCommercial: "商业保险 (可选，单位，人民币/年)",
        taxTableHeader: "12个月税额表",
        thMonth: "月份",
        thCumulative: "累计应税收入 (¥)",
        thRate: "税率 %",
        thQuickDed: "速算扣除数",
        thTax: "应纳税额 (¥)",
        thNetPay: "税后收入 (¥)",
        thNetPayUSD: "税后收入 (美元)",
        benefitCalcHeader: "福利计算",
        benefitTableCategory: "类别",
        benefitTableBase: "缴费基数",
        benefitTableEmployer: "单位 ¥",
        benefitTableEmployee: "个人 ¥",
        commercialInsuranceRow: "商业保险 (可选)",
        employerTotal: "月度单位合计:",
        employeeTotal: "月度个人合计:",
        monthlyTaxableIncome: "月度应税收入:",
        taxableFormulaPrefix: "(基本工资 ¥",
        taxableFormulaMid1: " - 可扣除的个人福利 ¥",
        taxableFormulaMid2: " - 标准扣除 ¥",
        taxableFormulaSuffix: ")",
        taxDeductionHeader: "税前扣除设置",
        labelCorpPensionDeduction: "个人缴纳企业年金税前扣除比例 (%)",
        employeeBenefitsBreakdown: "可扣除的个人福利明细:",
        corpPensionTotal: "企业年金 (总额):",
        corpPensionDeductible: "企业年金 (可扣除):",
        corpPensionNonDeductible: "企业年金 (不可扣除):",
        otherEmployeeBenefits: "其他个人福利:",
        totalEmployeeBenefits: "可扣除的个人福利合计:"
      }
    };

    let currentLanguage = 'en';

    const benefitNoteMapping = {
      'notePension': 'pension',
      'noteMedical': 'medical',
      'noteUnemployment': 'unemployment',
      'noteWorkInjury': 'work_injury',
      'noteMaternity': 'maternity',
      'noteHousing': 'housing_fund',
      'noteSupplementary': 'supplementary_housing',
      'noteCorporate': 'corporate_pension'
    };

    function updateBenefitNotes() {
      const city = citySelect.value;
      const config = cityConfig.cities[city];
      
      Object.keys(benefitNoteMapping).forEach(noteId => {
        const benefitKey = benefitNoteMapping[noteId];
        const benefit = config.benefits[benefitKey];
        const note = currentLanguage === 'zh' ? (benefit.note_cn || '') : (benefit.note_en || '');
        document.getElementById(noteId).innerText = note;
      });
    }

    function updateLanguage(lang) {
      currentLanguage = lang;
      const t = translations[lang];
      
      // Update all static text elements
      document.getElementById('pageTitle').innerText = t.pageTitle;
      document.getElementById('inputHeader').innerText = t.inputHeader;
      document.getElementById('resultsHeader').innerText = t.resultsHeader;
      document.getElementById('limitsHeader').innerText = t.limitsHeader;
      document.getElementById('benefitRatesHeader').innerText = t.benefitRatesHeader;
      document.getElementById('taxTableHeader').innerText = t.taxTableHeader;
      
      // Update labels (preserve input elements)
      document.getElementById('labelSalaryUSD').childNodes[0].nodeValue = t.labelSalaryUSD;
      document.getElementById('labelExchangeRate').childNodes[0].nodeValue = t.labelExchangeRate;
      document.getElementById('labelSalaryRMB').childNodes[0].nodeValue = t.labelSalaryRMB;
      document.getElementById('labelCity').childNodes[0].nodeValue = t.labelCity;
      document.getElementById('labelSIUpper').childNodes[0].nodeValue = t.labelSIUpper;
      document.getElementById('labelSILower').childNodes[0].nodeValue = t.labelSILower;
      document.getElementById('labelHFUpper').childNodes[0].nodeValue = t.labelHFUpper;
      document.getElementById('labelHFLower').childNodes[0].nodeValue = t.labelHFLower;
      document.getElementById('labelCommercial').childNodes[0].nodeValue = t.labelCommercial;
      document.getElementById('taxDeductionHeader').innerText = t.taxDeductionHeader;
      document.getElementById('labelCorpPensionDeduction').childNodes[0].nodeValue = t.labelCorpPensionDeduction;
      
      // Update table headers
      document.getElementById('thCategory').innerText = t.thCategory;
      document.getElementById('thEmployer').innerText = t.thEmployer;
      document.getElementById('thEmployee').innerText = t.thEmployee;
      
      // Update benefit categories
      document.getElementById('tdPension').innerText = t.tdPension;
      document.getElementById('tdMedical').innerText = t.tdMedical;
      document.getElementById('tdUnemployment').innerText = t.tdUnemployment;
      document.getElementById('tdWorkInjury').innerText = t.tdWorkInjury;
      document.getElementById('tdMaternity').innerText = t.tdMaternity;
      document.getElementById('tdHousing').innerText = t.tdHousing;
      document.getElementById('tdSupplementary').innerText = t.tdSupplementary;
      document.getElementById('tdCorporate').innerText = t.tdCorporate;
      
      // Update tax table headers
      document.getElementById('thMonth').innerText = t.thMonth;
      document.getElementById('thCumulative').innerText = t.thCumulative;
      document.getElementById('thRate').innerText = t.thRate;
      document.getElementById('thQuickDed').innerText = t.thQuickDed;
      document.getElementById('thTax').innerText = t.thTax;
      document.getElementById('thNetPay').innerText = t.thNetPay;
      document.getElementById('thNetPayUSD').innerText = t.thNetPayUSD;
      
      // Update benefit notes
      updateBenefitNotes();
      
      // Recalculate to update dynamic content
      calculate();
    }

    const rateInput = document.getElementById('rate');
    const salaryUSD = document.getElementById('salaryUSD');
    const salaryRMB = document.getElementById('salaryRMB');
    const citySelect = document.getElementById('city');
    const languageSelect = document.getElementById('languageSelect');

    function syncCurrency(e){
      const rate = parseFloat(rateInput.value)||7.12;
      if(e.target===salaryUSD){ salaryRMB.value=(salaryUSD.value*rate).toFixed(2); }
      else if(e.target===salaryRMB){ salaryUSD.value=(salaryRMB.value/rate).toFixed(2); }
      calculate();
    }
    rateInput.addEventListener('input', syncCurrency);
    salaryUSD.addEventListener('input', syncCurrency);
    salaryRMB.addEventListener('input', syncCurrency);

    // Language selector
    languageSelect.addEventListener('change', function() {
      updateLanguage(this.value);
    });

    // Update form values when city changes
    function loadCityConfig(){
      const city = citySelect.value;
      const config = cityConfig.cities[city];
      
      // Update base limits
      document.getElementById('siUpper').value = config.meta.social_insurance_base.upper;
      document.getElementById('siLower').value = config.meta.social_insurance_base.lower;
      document.getElementById('hfUpper').value = config.meta.housing_fund_base.upper;
      document.getElementById('hfLower').value = config.meta.housing_fund_base.lower;
      
      // Update benefit rates
      document.getElementById('penE').value = parseFloat((config.benefits.pension.employer_rate * 100).toFixed(2));
      document.getElementById('penP').value = parseFloat((config.benefits.pension.employee_rate * 100).toFixed(2));
      document.getElementById('medE').value = parseFloat((config.benefits.medical.employer_rate * 100).toFixed(2));
      document.getElementById('medP').value = parseFloat((config.benefits.medical.employee_rate * 100).toFixed(2));
      document.getElementById('uneE').value = parseFloat((config.benefits.unemployment.employer_rate * 100).toFixed(2));
      document.getElementById('uneP').value = parseFloat((config.benefits.unemployment.employee_rate * 100).toFixed(2));
      document.getElementById('injE').value = parseFloat((config.benefits.work_injury.employer_rate * 100).toFixed(2));
      document.getElementById('injP').value = parseFloat((config.benefits.work_injury.employee_rate * 100).toFixed(2));
      document.getElementById('matE').value = parseFloat((config.benefits.maternity.employer_rate * 100).toFixed(2));
      document.getElementById('matP').value = parseFloat((config.benefits.maternity.employee_rate * 100).toFixed(2));
      document.getElementById('houE').value = parseFloat((config.benefits.housing_fund.employer_rate * 100).toFixed(2));
      document.getElementById('houP').value = parseFloat((config.benefits.housing_fund.employee_rate * 100).toFixed(2));
      document.getElementById('supE').value = parseFloat((config.benefits.supplementary_housing.employer_rate * 100).toFixed(2));
      document.getElementById('supP').value = parseFloat((config.benefits.supplementary_housing.employee_rate * 100).toFixed(2));
      document.getElementById('corE').value = parseFloat((config.benefits.corporate_pension.employer_rate * 100).toFixed(2));
      document.getElementById('corP').value = parseFloat((config.benefits.corporate_pension.employee_rate * 100).toFixed(2));
      document.getElementById('comE').value = config.benefits.commercial_insurance.employer_paid;
      
      // Update benefit notes
      updateBenefitNotes();
      
      calculate();
    }
    
    citySelect.addEventListener('change', loadCityConfig);

    const taxBrackets=[
      {max:36000,rate:0.03,ded:0},
      {max:144000,rate:0.10,ded:2520},
      {max:300000,rate:0.20,ded:16920},
      {max:420000,rate:0.25,ded:31920},
      {max:660000,rate:0.30,ded:52920},
      {max:960000,rate:0.35,ded:85920},
      {max:Infinity,rate:0.45,ded:181920}
    ];

    const ids=['pen','med','une','inj','mat','hou','sup','cor'];
    const idNames={
      'pen':'Pension Insurance',
      'med':'Medical Insurance', 
      'une':'Unemployment Insurance',
      'inj':'Work Injury Insurance',
      'mat':'Maternity Insurance',
      'hou':'Housing Fund',
      'sup':'Supplementary HF (Optional)',
      'cor':'Corporate Pension (Optional)'
    };
    const idToElementId={
      'pen':'tdPension',
      'med':'tdMedical',
      'une':'tdUnemployment',
      'inj':'tdWorkInjury',
      'mat':'tdMaternity',
      'hou':'tdHousing',
      'sup':'tdSupplementary',
      'cor':'tdCorporate'
    };

    // Format number with thousand separators
    function formatAmount(num, decimals = 0) {
      return num.toLocaleString('en-US', {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function calculate(){
      const base=parseFloat(salaryRMB.value)||0;
      const siU=parseFloat(siUpper.value),siL=parseFloat(siLower.value);
      const hfU=parseFloat(hfUpper.value),hfL=parseFloat(hfLower.value);

      let siBase=Math.min(Math.max(base,siL),siU);
      let hfBase=Math.min(Math.max(base,hfL),hfU);

      // Get current city config for extra fixed amounts
      const city = citySelect.value;
      const config = cityConfig.cities[city];

      // Get translations for current language
      const t = translations[currentLanguage];

      const rate = parseFloat(rateInput.value)||7.12;
      
      let empE=0, empP=0;
      let corpPensionEmployeeAmt = 0; // Track corporate pension employee contribution separately
      let details=`<h3>${t.benefitCalcHeader}</h3><table><tr><th>${t.benefitTableCategory}</th><th>${t.benefitTableBase}</th><th>${t.benefitTableEmployer}</th><th>${t.benefitTableEmployer} (USD)</th><th>${t.benefitTableEmployee}</th><th>${t.benefitTableEmployee} (USD)</th></tr>`;
      ids.forEach(id=>{
        const e=document.getElementById(id+'E').value/100;
        const p=document.getElementById(id+'P').value/100;
        let b=(id==='hou'||id==='sup')?hfBase:(id==='cor'?base:siBase);
        const eAmt=b*e;
        let pAmt=b*p;
        
        empE+=eAmt;
        empP+=pAmt;
        
        // Track corporate pension employee contribution
        if(id === 'cor') {
          corpPensionEmployeeAmt = pAmt;
        }
        
        // Use translated category name
        const categoryName = document.getElementById(idToElementId[id]).innerText;
        
        details+=`<tr><td>${categoryName}</td><td>${formatAmount(b)}</td><td>${formatAmount(eAmt)}</td><td>${formatAmount(eAmt/rate)}</td><td>${formatAmount(pAmt)}</td><td>${formatAmount(pAmt/rate)}</td></tr>`;
      });

      const comE=parseFloat(document.getElementById('comE').value)||0;
      const comEMonthly=comE/12;
      empE+=comEMonthly;
      
      // Add commercial insurance row to the table
      if(comE > 0){
        details+=`<tr><td>${t.commercialInsuranceRow}</td><td>${formatAmount(comE)}/year</td><td>${formatAmount(comEMonthly)}</td><td>${formatAmount(comEMonthly/rate)}</td><td>0</td><td>0</td></tr>`;
      }

      details+="</table>";
      document.getElementById('benefits').innerHTML=details;

      const standardDeduction=5000;
      
      // Apply enterprise annuity pre-tax deduction rate
      const corpPensionDeductionRate = parseFloat(document.getElementById('corpPensionDeductionRate').value) || 67;
      const corpPensionDeductibleAmt = corpPensionEmployeeAmt * (corpPensionDeductionRate / 100);
      const corpPensionNonDeductibleAmt = corpPensionEmployeeAmt - corpPensionDeductibleAmt;
      
      // Monthly taxable = Base - Standard Deduction - (Employee Benefits - Corp Pension + Corp Pension * Deduction Rate)
      // Which simplifies to: Base - Standard Deduction - Employee Benefits + Corp Pension * (1 - Deduction Rate)
      const monthlyTaxable=Math.max(base-standardDeduction-empP+corpPensionNonDeductibleAmt,0);

      let tbody=document.querySelector('#taxTable tbody');
      tbody.innerHTML='';
      let prevTax=0;
      for(let m=1;m<=12;m++){
        const cum=monthlyTaxable*m;
        const br=taxBrackets.find(b=>cum<=b.max);
        const totalTax=cum*br.rate-br.ded;
        const monthTax=Math.max(totalTax-prevTax,0);
        prevTax=totalTax;
        const net=monthlyTaxable-monthTax;
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${m}</td><td>${formatAmount(cum)}</td><td>${(br.rate*100).toFixed(0)}%</td><td>${formatAmount(br.ded, 0)}</td><td>${formatAmount(monthTax)}</td><td>${formatAmount(net)}</td><td>${formatAmount(net/rate)}</td>`;
        tbody.appendChild(tr);
      }

      // Calculate the adjusted employee benefits for display (subtract non-deductible portion)
      const adjustedEmpP = empP - corpPensionNonDeductibleAmt;
      
      // Calculate other employee benefits (excluding corporate pension)
      const otherEmployeeBenefitsAmt = empP - corpPensionEmployeeAmt;
      
      document.getElementById('summary').innerHTML=
        `<div class="summary-box">
          <p><b>${t.employerTotal}</b> ¥${formatAmount(empE)} (USD $${formatAmount(empE/rate)})</p>
          <p><b>${t.employeeTotal}</b> ¥${formatAmount(empP)} (USD $${formatAmount(empP/rate)})</p>
          <p><b>${t.monthlyTaxableIncome}</b> ¥${formatAmount(monthlyTaxable)} (USD $${formatAmount(monthlyTaxable/rate)})
            <small>${t.taxableFormulaPrefix}${formatAmount(base)}${t.taxableFormulaMid1}${formatAmount(adjustedEmpP)}${t.taxableFormulaMid2}${formatAmount(standardDeduction, 0)}${t.taxableFormulaSuffix}</small>
          </p>
          <div style="margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; border-left: 3px solid #3b82f6;">
            <p style="margin-bottom: 0.5rem; font-weight: 600; color: #1e40af;">${t.employeeBenefitsBreakdown}</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem;"><b>${t.corpPensionTotal}</b> ¥${formatAmount(corpPensionEmployeeAmt)} (USD $${formatAmount(corpPensionEmployeeAmt/rate)})</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem; color: #059669;"><b>${t.corpPensionDeductible}</b> ¥${formatAmount(corpPensionDeductibleAmt)} (USD $${formatAmount(corpPensionDeductibleAmt/rate)}) - ${corpPensionDeductionRate}%</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem; color: #dc2626;"><b>${t.corpPensionNonDeductible}</b> ¥${formatAmount(corpPensionNonDeductibleAmt)} (USD $${formatAmount(corpPensionNonDeductibleAmt/rate)}) - ${100-corpPensionDeductionRate}%</p>
            <p style="margin: 0.25rem 0; font-size: 0.9rem;"><b>${t.otherEmployeeBenefits}</b> ¥${formatAmount(otherEmployeeBenefitsAmt)} (USD $${formatAmount(otherEmployeeBenefitsAmt/rate)})</p>
            <p style="margin: 0.5rem 0 0 0; font-weight: 600; color: #1e40af; border-top: 1px solid #e5e7eb; padding-top: 0.5rem;"><b>${t.totalEmployeeBenefits}</b> ¥${formatAmount(adjustedEmpP)} (USD $${formatAmount(adjustedEmpP/rate)})</p>
          </div>
        </div>`;
    }

    document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input',calculate));
    
    // Load initial city config
    loadCityConfig();
  </script>
</body>
</html>